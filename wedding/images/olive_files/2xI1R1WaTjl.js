/*!CK:3831027296!*//*1454900602,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["Zxneq"]); }

__d('BrowserPushCommands',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h='browser_push_ack',i='browser_push_redirect',j='browser_push_window_visible',k={ACK:h,REDIRECT:i,WINDOW_VISIBLE:j};f.exports=k;},null);
__d('BrowserPushMessageHandler',['BrowserPushCommands','EventListener','isFacebookURI','URISchemes'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();function l(event){if(event.data.command&&event.data.command===h.REDIRECT){if(typeof window.onbeforeunload()==='undefined'){event.ports[0].postMessage({command:h.ACK,success:true});}else{event.ports[0].postMessage({command:h.ACK,success:false});return;}var n=event.data.uri;if(/^([^.:/?#]+):/.test(n)&&!k.isAllowed(/^([^.:/?#]+):/.exec(n)[0])&&j(n))throw new Error('goURI: URI scheme rejected, URI: '+n);window.location.href=n;}}var m={registerRedirectHandler:function(){i.listen(window,'message',function(event){if(event.origin==="")l(event);});if(navigator.serviceWorker&&navigator.serviceWorker.addEventListener)navigator.serviceWorker.addEventListener('message',function(event){if(new RegExp('^'+window.location.protocol+'//'+window.location.host+'$').test(event.origin))l(event);});}};f.exports=m;},null);
__d('BrowserPushVisibilityChanger',['BrowserPushCommands','ClientServiceWorkerMessage','Visibility'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();function k(){new i(h.WINDOW_VISIBLE,null).sendViaController();}var l={listenForVisibility:function(){if(!j.isHidden())k();j.addListener(j.VISIBLE,k);}};f.exports=l;},null);
__d('PushRegistration',['Promise','BrowserPushMessageHandler','BrowserPushVisibilityChanger','Map','ServiceWorkerRegistration'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=window.Notification,n=new k();o.get=function(p,q){'use strict';if(n.has(q))return n.get(q);var r=new o(p,q);n.set(q,r);return r;};function o(p,q){'use strict';this.$PushRegistration1=p;this.appID=q;if(!o.$PushRegistration2&&!o.$PushRegistration3){o.$PushRegistration2=false;o.$PushRegistration3=false;}}o.prototype.getPushSubscription=function(){'use strict';return new h((function(p,q){if(!m||m.permission==='denied')q(new Error('No permission or not supported'));l.getWorkerRegistration(this.$PushRegistration1).then(function(r){if(!r){p(null);return;}r.pushManager.getSubscription().then(function(s){p(s);})['catch'](q);})['catch'](q);}).bind(this));};o.prototype.$PushRegistration4=function(p){'use strict';var q=p.endpoint;if('subscriptionId' in p&&!new RegExp('/'+p.subscriptionId+'$').test(q))q+='/'+p.subscriptionId;return q;};o.prototype.$PushRegistration5=function(p,q,r,s){'use strict';var t=this.$PushRegistration4(r),u=null;if(r.getKey){var v=new Uint8Array(r.getKey('p256dh')),w=[];for(var x=0;x<v.length;x++)w.push(String.fromCharCode(v[x]));u=window.btoa(w);}var y=p.getURIBuilder().getURI(),z=new q(y);z.setData({app_id:this.appID,push_endpoint:t,endpoint_key:u});z.setMethod('post');if(z.setHandler)z.setHandler(function(aa){if(aa.payload&&aa.payload.session_change)s();});z.send();};o.prototype.getSubscription=function(){'use strict';return new h((function(p,q){this.getPushSubscription().then((function(r){if(r){p(this.$PushRegistration4(r));}else p(null);}).bind(this))['catch'](q);}).bind(this));};o.prototype.maybeRegisterPushAgain=function(p,q,r){'use strict';return new h((function(s,t){this.getPushSubscription().then((function(u){if(u){this.$PushRegistration5(p,q,u,r);s(this.$PushRegistration4(u));}else s(null);}).bind(this))['catch'](function(){s(null);});}).bind(this));};o.prototype.$PushRegistration6=function(p,q,r){'use strict';return new h((function(s,t){if(o.$PushRegistration3&&!r){t(new Error('sending disable info already'));return;}o.$PushRegistration3=true;var u=p.getURIBuilder().getURI(),v=new q(u.toString());v.setData({appid:this.appID,from_browser_settings:r});v.setMethod('post');if(v.listen){v.listen('finally',s);v.listen('fail',function(){o.$PushRegistration3=false;t();});}else if(v.setErrorHandler&&v.setHandler){v.setErrorHandler(function(){o.$PushRegistration3=false;t();});v.setHandler(s);}else s();v.send();}).bind(this));};o.prototype.isPushRegistered=function(p,q,r,s,t,u){'use strict';i.registerRedirectHandler();return new h((function(v,w){this.getPushSubscription().then((function(x){v(!!x||p&&!o.pushPermissionIsPending());if(x){if(t){x.unsubscribe().then((function(){this.registerPush(q,s,u);}).bind(this))['catch'](function(){});}else j.listenForVisibility();}else if(!x&&p)if(o.pushPermissionIsOn()){this.registerPush(q,s,u)['catch'](function(){});}else this.$PushRegistration6(r,s,false);}).bind(this))['catch']((function(){if(p){this.$PushRegistration6(r,s,false);w();}}).bind(this));}).bind(this));};o.prototype.$PushRegistration7=function(){'use strict';return new h(function(p,q){m.requestPermission(p);});};o.prototype.registerPushAndWaitForEndpoint=function(p,q,r){'use strict';return new h((function(s,t){this.$PushRegistration8(p,q,r,true).then(function(u){if(typeof u!=='string'){t(new Error('registerPushImpl did not return an endpoint'));return;}s(u);})['catch'](t);}).bind(this));};o.prototype.registerPush=function(p,q,r){'use strict';return new h((function(s,t){this.$PushRegistration8(p,q,r,false).then(function(u){if(typeof u!=='boolean'){t(new Error('registerPushImpl did not return a boolean'));return;}s(u);})['catch'](t);}).bind(this));};o.prototype.$PushRegistration8=function(p,q,r,s){'use strict';if(o.$PushRegistration2)return new h(function(t,u){u(new Error('registering already'));});o.$PushRegistration2=true;return new h((function(t,u){var v=l.registerWorkerIfUnregistered(this.$PushRegistration1),w=this.$PushRegistration7();h.all([v,w]).then((function(x){var y=x[0];if(!o.pushPermissionIsOn()){y.unregister();throw new Error('Push permission was denied');}if(!s)t(true);y.pushManager.subscribe({userVisibleOnly:true}).then((function(z){if(s)t(this.$PushRegistration4(z));this.$PushRegistration5(p,q,z,r);j.listenForVisibility();}).bind(this))['catch'](function(z){o.$PushRegistration2=false;y.unregister();u(z);});}).bind(this))['catch'](function(x){o.$PushRegistration2=false;u(x);});}).bind(this));};o.prototype.unregisterPushAndSW=function(p,q){'use strict';return new h((function(r,s){this.$PushRegistration6(p,q,true).then((function(){l.getWorkerRegistration(this.$PushRegistration1).then(function(t){if(t){t.pushManager.getSubscription().then(function(u){u.unsubscribe().then(function(){t.unregister().then(r).reject(s);})['catch'](function(){r(true);});})['catch'](function(){r(true);});}else t.unregister().then(r).reject(s);})['catch'](s);}).bind(this))['catch'](s);}).bind(this));};o.pushPermissionIsPending=function(){'use strict';return m&&m.permission==='default';};o.pushPermissionIsOn=function(){'use strict';return m&&m.permission==='granted';};f.exports=o;},null);
__d("XBrowserPushMuteController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/notifications\/client\/push\/mute\/",{push_endpoint:{type:"String",required:true},appid:{type:"Int",required:true},is_settings_page:{type:"Bool",defaultValue:false},__asyncDialog:{type:"Int"}});},null);
__d('BrowserPushMuteOptions',['AsyncRequest','PushRegistration','React','ReactDOM','XBrowserPushMuteController','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();function n(p,q,r){var s=i.get(q,r);s.getPushSubscription().then(function(t){if(t){var u=l.getURIBuilder().setString('push_endpoint',t.endpoint).setInt('appid',r).getURI();new h().setURI(u).setRelativeTo(p).send();}})['catch'](function(t){throw t;});}var o={showMuteOptions:function(p,q,r){if(!i.pushPermissionIsOn())return;k.render(j.createElement('a',{href:'#',onClick:function(){n(p,q,r);}},m._("Mute")),p);}};f.exports=o;},null);