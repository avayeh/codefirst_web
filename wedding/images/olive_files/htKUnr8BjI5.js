/*!CK:2412661086!*//*1455246645,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["J0U3I"]); }

__d("MercuryActionStatus",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={UNSENT:0,SUCCESS:1,UNCONFIRMED:3,FAILED_UNKNOWN_REASON:4,UNABLE_TO_CONFIRM:5,RESENT:6,RESENDING:7,ERROR:10};},null);
__d("MercuryActionType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={LOG_MESSAGE:"ma-type:log-message",USER_GENERATED_MESSAGE:"ma-type:user-generated-message",CHANGE_READ_STATUS:"ma-type:change_read_status",MARK_THREAD_SEEN:"ma-type:mark_thread_seen",CHANGE_MUTE_SETTINGS:"ma-type:change-mute-settings",SEND_MESSAGE:"ma-type:send-message",UPDATE_ACTION_ID:"ma-type:update-action-id",DELETE_MESSAGES:"ma-type:delete-messages",DELETE_THREAD:"ma-type:delete-thread",UPDATE_SNIPPET:"ma-type:update-snippet",CHANGE_ARCHIVED_STATUS:"ma-type:change-archived-status",CHANGE_FOLDER:"ma-type:change-folder",ADD_PARTICIPANTS:"ma-type:add-participants",CANCEL_ATTACHMENT_PLACEHOLDER:"ma-type:cancel-attachment-placeholder",CONFIRM_ATTACHMENT_PLACEHOLDER:"ma-type:confirm-attachment-placeholder",UNPIN_THREAD:"ma-type:unpin-thread",CHANGE_FLAG:"ma-type:change_flag",MOVE_PENDING_TO_INBOX:"ma-type:move_pending_to_inbox",UPDATE_BLOCKER_STATUS:"ma-type:update-blocker-status",UPDATE_BLOCKEE_STATUS:"ma-type:update-blockee-status",CREATE_PAGE_ADMIN_NOTE:"ma-type:create-page-admin-note",REPLACE_MESSAGE:"ma-type:replace-message",UPDATE_CUSTOM_LIKE:"ma-type:update_custom_like",UNWRAP_MESSAGE:"ma-type:unwrap-message"};},null);
__d("MercuryAPIArgsSource",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={CHAT:"chat",JEWEL:"jewel",MERCURY:"mercury",MERCURYSYNC:"mercury_sync",WEBMESSENGER:"web_messenger",MESSENGER:"messenger"};},null);
__d("MercuryAttachmentContentType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={PHOTO:"attach:image",VIDEO:"attach:video",MUSIC:"attach:music",VOICE:"attach:voice",TEXT:"attach:text",MSWORD:"attach:ms:word",MSXLS:"attach:ms:xls",MSPPT:"attach:ms:ppt",ORION:"attach:orion",SHOERACK_INVITATION:"attach:shoerackinvite",UNKNOWN:"attach:unknown"};},null);
__d("MercuryAttachmentType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={ERROR:"error",FILE:"file",PHOTO:"photo",STICKER:"sticker",SHARE:"share",UNKNOWN:"unknown",VIDEO:"video",ANIMATED_IMAGE:"animated_image",EMOJI_LIKE:"emoji_like",GIFT:"gift"};},null);
__d("MercuryAudioType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={AudioClip:"fb_voice_message",VoiceMessageWithTranscript:"fb_voice_message_with_transcript"};},null);
__d("MercuryErrorType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={SERVER:1,TRANSPORT:2,TIMEOUT:3};},null);
__d("MercuryGlobalActionType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={MARK_ALL_READ:"mga-type:mark-all-read"};},null);
__d("MercuryLogMessageType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={SUBSCRIBE:"log:subscribe",UNSUBSCRIBE:"log:unsubscribe",VIDEO_CALL:"log:video-call",PHONE_CALL:"log:phone-call",THREAD_NAME:"log:thread-name",THREAD_IMAGE:"log:thread-image",SERVER_ERROR:"log:error-msg",LIVE_LISTEN:"log:live-listen",WALLPAPER:"log:wallpaper",ORION:"log:orion",SWITCH_TO_WORK:"log:switch",PAGE_REPLY:"log:page-reply",GENERIC_ADMIN_TEXT:"log:generic-admin-text"};},null);
__d("MercuryPayloadSource",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={UNKNOWN:"unknown",CLIENT_CHANNEL_MESSAGE:"client_channel_message",CLIENT_SEND_MESSAGE:"client_send_message",CLIENT_CHANGE_ARCHIVED_STATUS:"client_change-archived_status",CLIENT_CHANGE_FOLDER:"client_change_folder",CLIENT_CHANGE_MUTE_SETTINGS:"client_change_mute_settings",CLIENT_CHANGE_READ_STATUS:"client_change_read_status",CLIENT_CHANGE_CUSTOM_LIKE:"client_change_custom_like",CLIENT_MARK_THREAD_SEEN:"client_mark_thread_seen",CLIENT_ADD_PARTICIPANTS:"client_add_participants",CLIENT_FETCH_PARTICIPANTS:"client_fetch_participants",CLIENT_DELETE_MESSAGES:"client_delete_messages",CLIENT_DELETE_THREAD:"client_delete_thread",CLIENT_UPDATE_SNIPPET:"client_update_snippet",CLIENT_HANDLE_ERROR:"client_handle_error",CLIENT_UNPIN_THREAD:"client_unpin_thread",CLIENT_CHANGE_FLAG:"client_change_flag",CLIENT_MOVE_PENDING_TO_INBOX:"client_move_pending_to_inbox",CLIENT_CREATE_PAGE_ADMIN_NOTE:"client_create_page_admin_note",CLIENT_UNWRAP_MESSAGE:"client_unwrap_message",SERVER_INITIAL_DATA:"server_initial_data",SERVER_SEND_MESSAGE:"server_send_message",SERVER_CHANGE_ARCHIVED_STATUS:"server_change_archived_status",SERVER_CHANGE_READ_STATUS:"server_change_read_status",SERVER_MARK_FOLDER_READ:"server_mark_folder_read",SERVER_MARK_SEEN:"server_mark_seen",SERVER_FETCH_PARTICIPANTS:"server_fetch_participants",SERVER_FETCH_THREAD_INFO:"server_fetch_thread_info",SERVER_FETCH_THREADLIST_INFO:"server_fetch_threadlist_info",SERVER_STANDALONE_NOTIFICATIONS:"server_standalone_notifications",SERVER_THREAD_SYNC:"server_thread_sync",SERVER_TAB_PRESENCE:"server_tab_presence",SERVER_UNREAD_THREADS:"server_unread_threads",SERVER_SEARCH:"server_search",SERVER_CHANGE_FLAG:"server_change_flag",SERVER_INVALIDATE_THREAD_STATE:"server_invalidate_thread_state",SERVER_INVALIDATE_GLOBAL_STATE:"server_invalidate_global_state"};},null);
__d("MercurySourceType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={CHAT_ORCA:"source:chat:orca",CHAT_IPHONE:"source:chat:iphone",CHAT_JABBER:"source:chat:jabber",CHAT_MEEBO:"source:chat:meebo",CHAT_WEB:"source:chat:web",CHAT_TEST:"source:chat:test",CHAT_FORWARD_DIALOG:"source:chat:forward",CHAT:"source:chat",EMAIL:"source:email",EVENT_MESSAGE_BLAST:"source:event_message_blast",GIGABOXX_API:"source:gigaboxx:api",GIGABOXX_BLAST:"source:gigaboxx:blast",GIGABOXX_EMAIL_REPLY:"source:gigaboxx:emailreply",GIGABOXX_MOBILE:"source:gigaboxx:mobile",GIGABOXX_WAP:"source:gigaboxx:wap",GIGABOXX_WEB:"source:gigaboxx:web",LEIA:"source:leia",MESSENGER_WEB:"source:messenger:web",SAM_UFI:"source:sam:ufi",SHARE_DIALOG:"source:share:dialog",SEND_PLUGIN:"source:sendplugin",SMS:"source:sms",TEST:"source:test",TITAN_WAP:"source:titan:wap",TITAN_M_BASIC:"source:titan:m_basic",TITAN_M_FREE:"source:titan:m_free_basic",TITAN_M_JAPAN:"source:titan:m_japan",TITAN_M_MINI:"source:titan:m_mini",TITAN_M_TOUCH:"source:titan:m_touch",TITAN_M_APP:"source:titan:m_app",TITAN_M_TABLET:"source:titan:m_tablet",TITAN_M_ZERO:"source:titan:m_zero",TITAN_M_TALK:"source:titan:m_talk",TITAN_WEB:"source:titan:web",TITAN_FACEWEB_ANDROID:"source:titan:faceweb_android",TITAN_FACEWEB_BUFFY:"source:titan:faceweb_buffy",TITAN_FACEWEB_IPAD:"source:titan:faceweb_ipad",TITAN_FACEWEB_IPHONE:"source:titan:faceweb_iphone",TITAN_FACEWEB_UNKNOWN:"source:titan:faceweb_unknown",TITAN_API:"source:titan:api",TITAN_API_MOBILE:"source:titan:api_mobile",TITAN_ORCA:"source:titan:orca",TITAN_EMAIL_REPLY:"source:titan:emailreply",MOBILE:"source:mobile",PAGE_PLATFORM_API:"source:page_platform_api",UNKNOWN:"source:unknown",WEB:"source:web",HELPCENTER:"source:helpcenter",NEW_SHARE_DIALOG:"source:share:dialog:new",PAID_PROMOTION:"source:paid_promotion",BUFFY_SMS:"source:buffy:sms",WEBRTC_MOBILE:"source:webrtc:mobile",MESSENGER_COMMERCE:"source:messenger:commerce",MESSENGER_BOT:"source:bot",PAGES_PRIVATE_REPLY:"source:pages:private_reply",MESSENGER_FORWARD_DIALOG:"source:messenger:forward",MESSENGER_AD:"source:messenger:ad"};},null);
__d("MessagingGenericAdminTextType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={CONFIRM_FRIEND_REQUEST:"confirm_friend_request",ACCEPT_PENDING_THREAD:"accept_pending_thread",RAMP_UP_WELCOME_MESSAGE:"ramp_up_welcome_message",CHANGE_THREAD_THEME:"change_thread_theme",CHANGE_THREAD_ICON:"change_thread_icon",GROUP_THREAD_CREATED:"group_thread_created",THREAD_EPHEMERAL_SEND_MODE:"thread_ephemeral_send_mode",INVITE_ACCEPTED:"invite_accepted",MESSENGER_INVITE_SENT:"messenger_invite_sent",TURN_ON_PUSH:"turn_on_push",JOURNEY_PROMPT_COLOR:"journey_prompt_color",JOURNEY_PROMPT_LIKE:"journey_prompt_like",JOURNEY_PROMPT_NICKNAME:"journey_prompt_nickname",JOURNEY_PROMPT_SETUP:"journey_prompt_setup",CHANGE_THREAD_NICKNAME:"change_thread_nickname",BOT_THREAD_SUBSCRIPTION:"bot_thread_subscription",RTC_CALL_LOG:"rtc_call_log",JOURNEY_PROMPT_BOT:"journey_prompt_bot",RIDE_ORDERED_MESSAGE:"ride_ordered_message",JOURNEY_PROMPT_NEW_SETUP:"journey_prompt_new_setup",LIGHTWEIGHT_EVENT_CREATE:"lightweight_event_create",LIGHTWEIGHT_EVENT_NOTIFY:"lightweight_event_notify"};},null);
__d("MessagingTag",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={GROUPS:"groups",UNREAD:"unread",FLAGGED:"flagged",ACTION_ARCHIVED:"action:archived",INBOX:"inbox",OTHER:"other",PENDING:"pending",MONTAGE:"montage",EVENT:"event",SENT:"sent",SPAM:"spam",UPDATES:"broadcasts_inbox",BCC:"header:bcc",FILTERED_CONTENT:"filtered_content",FILTERED_CONTENT_BH:"filtered_content_bh",FILTERED_CONTENT_ACCOUNT:"filtered_content_account",FILTERED_CONTENT_QUASAR:"filtered_content_quasar",FILTERED_CONTENT_INVALID_APP:"filtered_content_invalid_app",UNAVAILABLE_ATTACHMENT:"unavailable_attachment",ARCHIVED:"archived",EMAIL:"email",VOICEMAIL:"voicemail",SPAM_SPOOFING:"spam:spoofing",SPOOF_WARNING:"MTA:spoof_warning",SMS_TAG_ROOT:"SMSShortcode:",APP_ID_ROOT:"app_id:",DOMAIN_AUTH_PASS:"MTA:dmarc:pass",DOMAIN_AUTH_FAIL:"MTA:dmarc:fail",MTA_SYSTEM_MESSAGE:"MTA:system_message",EMAIL_MESSAGE:"source:email"};},null);
__d("PageMessageEnumTag",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={FLAG:"flag",LOW_VALUE:"low_value",SPAM_SPOOFING:"spam_spoofing"};},null);
__d("PagesMessagingConst",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={LOAD_MESSAGE_THREAD_URI:"\/ajax\/pages\/messages\/load_message_thread.php",ASYNC_ENDPOINT:"\/ajax\/messaging\/async.php",UNANSWERED_FILTER:"unanswered"};},null);
__d("StoryAttachmentStyle",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={FALLBACK:"fallback",SHARE:"share",OG_COMPOSER_SIMPLE:"og_composer_simple",SPORTS_MATCHUP:"sports_matchup",SHARE_LARGE_IMAGE:"share_large_image",PHOTO:"photo",COVER_PHOTO:"cover_photo",ALBUM:"album",NEW_ALBUM:"new_album",COUPON:"coupon",QUESTION:"question",ANSWER:"answer",OPTION:"option",GALLERY:"gallery",STREAM_PUBLISH:"stream_publish",MUSIC_AGGREGATION:"music_aggregation",ITEM_LIST:"list",HIGH_SCORE:"high_score",SCORE_LEADERBOARD:"score_leaderboard",FRIEND_LIST:"friend_list",CHECKIN:"checkin",POPULAR_OBJECTS:"popular_objects",AVATAR_LIST:"avatar_list",AVATAR:"avatar",AVATAR_WITH_VIDEO:"avatar_with_video",EVENT:"event",CANCELED_EVENT:"canceled_event",MINUTIAE_EVENT:"minutiae_event",EXPERIENCE:"experience",LIFE_EVENT:"life_event",TRAVEL_SLIDESHOW_LIFE_EVENT:"travel_slideshow_life_event",GIFT:"gift",IMAGE_SHARE:"image_share",ANIMATED_IMAGE_SHARE:"animated_image_share",ANIMATED_IMAGE_AUTOPLAY:"animated_image_autoplay",ANIMATED_IMAGE_VIDEO:"animated_image_video",ANIMATED_IMAGE_VIDEO_AUTOPLAY:"animated_image_video_autoplay",NOTE:"note",TOPIC:"topic",FILE_UPLOAD:"file_upload",NOTIFICATION_TARGET:"notification_target",UNAVAILABLE:"unavailable",PAGE_RECOMMENDATION:"page_recommendation",PAGE_VIDEO_PLAYLIST:"page_video_playlist",VIDEO:"video",VIDEO_INLINE:"video_inline",VIDEO_AUTOPLAY:"video_autoplay",VIDEO_SHARE:"video_share",VIDEO_SHARE_HIGHLIGHTED:"video_share_highlighted",VIDEO_SHARE_YOUTUBE:"video_share_youtube",VIDEO_DIRECT_RESPONSE:"video_direct_response",VIDEO_DIRECT_RESPONSE_AUTOPLAY:"video_direct_response_autoplay",MAP:"map",OG_MAP:"og_map",PRODUCT:"product",EXTERNAL_PRODUCT:"external_product",FITNESS_COURSE:"fitness_course",APPLICATION:"application",STICKER:"sticker",EXTERNAL_OG_PRODUCT:"external_og_product",TRAVEL_LOG:"travel_log",MULTI_SHARE:"multi_share",MULTI_SHARE_NO_END_CARD:"multi_share_no_end_card",MULTI_SHARE_SEARCH_END_CARD:"multi_share_search_end_card",YEAR_IN_REVIEW:"year_in_review",AVATAR_LARGE_COVER:"avatar_large_cover",COMMERCE_PRODUCT_ITEM:"commerce_product_item",COMMERCE_STORE:"commerce_store",THIRD_PARTY_PHOTO:"third_party_photo",PROMPT:"prompt",BIRTHDAY:"birthday",DONATIONS_CAMPAIGN:"donations_campaign",DONATE_PROMPT:"donate_prompt",DISCUSSION_CONVERSATION:"discussion_conversation",DISCUSSION_COMMENT:"discussion_comment",GROUP_SELL_PRODUCT_ITEM:"group_sell_product_item",GROUP_SELL_PRODUCT_ITEM_MARK_AS_SOLD:"group_sell_mark_as_sold",GAMETIME:"gametime",GAMETIME_PLAY:"gametime_play",GROUP_REPORTED_POST_QUEUE:"group_reported_post_queue",GROUP_PENDING_POST_QUEUE:"group_pending_post_queue",GROUP_JOIN_REQUEST_QUEUE:"group_join_request_queue",GREETING_CARD:"greeting_card",LEAD_GEN:"lead_gen",ATTACHED_STORY:"attached_story",POST_CHANNEL:"post_channel",TEXT_FOR_COLLAGE:"text_for_collage",SOUVENIR:"souvenir",SLIDESHOW:"slideshow",ORION:"orion",ORION_REQUEST:"orion_request",INSTANT_ARTICLE:"instant_article",MOMENTS_APP_INVITATION:"moments_app_invitation",MOMENTS_APP_PHOTO_REQUEST:"moments_app_photo_request",RIDE_ORDERED:"ride_ordered",RIDE_RECEIPT:"ride_receipt",BUSINESS_MESSAGE_ITEMS:"business_message_items",RETAIL_CANCELLATION:"retail_cancellation",RETAIL_PROMOTION:"retail_promotion",RETAIL_ITEM:"retail_item",RETAIL_NOW_IN_STOCK:"retail_now_in_stock",RETAIL_RECEIPT:"retail_receipt",RETAIL_SHIPMENT:"retail_shipment",RETAIL_SHIPMENT_FOR_SUPPORTED_CARRIER:"retail_shipment_for_supported_carrier",RETAIL_SHIPMENT_FOR_UNSUPPORTED_CARRIER:"retail_shipment_for_unsupported_carrier",RETAIL_SHIPMENT_TRACKING_EVENT:"retail_shipment_tracking_event",RETAIL_SHIPMENT_TRACKING_EVENT_ETA:"retail_shipment_tracking_event_eta",RETAIL_SHIPMENT_TRACKING_EVENT_IN_TRANSIT:"retail_shipment_tracking_event_in_transit",RETAIL_SHIPMENT_TRACKING_EVENT_OUT_FOR_DELIVERY:"retail_shipment_tracking_event_out_for_delivery",RETAIL_SHIPMENT_TRACKING_EVENT_DELAYED:"retail_shipment_tracking_event_delayed",RETAIL_SHIPMENT_TRACKING_EVENT_DELIVERED:"retail_shipment_tracking_event_delivered",SURVEY:"survey",MESSAGE_LOCATION:"message_location",JOB_OFFER:"job_offer",GROUP_ADD_MEMBERS:"group_add_memebers",RTC_CALL_LOG:"rtc_call_log",EVENTS_PENDING_POST_QUEUE:"events_pending_post_queue",EVENT_CALENDAR:"event_calendar",FACEPILE:"facepile",ATTRIBUTED_SHARE:"attributed_share",VIDEO_CINEMAGRAPH:"video_cinemagraph",LOCAL_CONTEXT_SHARE:"local_context_share",H_SCROLL:"h_scroll",EGO_HSCROLL:"ego_hscroll",MEDIA_QUESTION:"media_question",RICH_MEDIA:"rich_media",SQUARE_IMAGE_SHARE:"square_image_share",RETAIL_AGENT_ITEM_SUGGESTION:"retail_agent_item_suggestion",RETAIL_AGENT_ITEM_RECEIPT:"retail_agent_item_receipt",NOTE_COMPOSED:"note_composed",AVATAR_WITH_BIRTHDAY:"avatar_with_birthday",AIRLINE_FLIGHT_RESCHEDULE_UPDATE_BUBBLE:"airline_flight_reschedule_update_bubble",AIRLINE_CONFIRMATION:"airline_confirmation",AIRLINE_CHECK_IN:"airline_check_in",AIRLINE_BOARDING_PASS:"airline_boarding_pass",AIRLINE_FLIGHT_RESCHEDULE_UPDATE:"airline_flight_reschedule_update",LIGHTBOX_VIDEO:"lightbox_video",GLOBALLY_DELETED_MESSAGE_PLACEHOLDER:"globally_deleted_message_placeholder",GENIE_MESSAGE:"genie_message",MOVIE_BOT_MOVIE_LIST:"movie_bot_movie_list",MOVIE_BOT_MOVIE_SHOWTIME_LIST:"movie_bot_movie_showtime_list",AVATAR_WITH_EGO_ACTION:"avatar_with_ego_action",EVENT_TICKET:"event_ticket",VERTICAL_ATTACHMENT_LIST:"vertical_attachment_list",INSTANT_ARTICLE_LEGACY:"instant_article_legacy",FUNDRAISER_PAGE:"fundraiser_page",FINANCIAL_BILL_PAYMENT_REQUEST:"financial_bill_payment_request",GOODWILL_THROWBACK_FRIENDVERSARY_POLAROIDS_CARD:"goodwill_throwback_friendversary_polaroids_card",SAHELI_IMAGE:"saheli_image",LARGE_IMAGE_LIKE:"large_image_like",ASK_FRIENDS:"ask_friends",CULTURAL_MOMENT:"cultural_moment",TELEPHONE_CALL_LOG:"telephone_call_log",SUPER_EMOJI:"super_emoji",BOOK:"book",SUBTOPIC_CUSTOMIZATION_QUESTION:"subtopic_customization_question",SUBTOPIC_CUSTOMIZATION_OPTION:"subtopic_customization_option",RESTAURANT:"restaurant",CONNECTION_QUESTION:"connection_question",CONNECTION_QUESTION_OPTION:"connection_question_option",PYMI_ITEM:"pymi_item",GOODWILL_THROWBACK_FRIENDVERSARY_COLLAGE_CARD:"goodwill_throwback_friendversary_collage_card",CITY:"city",AVATAR_WITH_SHARE:"avatar_with_share",LIGHTWEIGHT_PLACE:"lightweight_place",QUOTED_SHARE:"quoted_share",SMS_LOG:"sms_log",CENTERED_TEXT:"centered_text",GOODWILL_THROWBACK_FRIENDVERSARY_DATA_CARD:"goodwill_throwback_friendversary_data_card",GOODWILL_THROWBACK_FACEVERSARY_COLLAGE_CARD:"goodwill_throwback_faceversary_collage_card",MESSAGE_EVENT:"message_event",MESSAGE_THREAD:"message_thread",QUOTE:"quote",VOTER_REGISTRATION_SHARE:"voter_registration_share",AIRLINE_ITINERARY:"airline_itinerary",AIRLINE_UPDATE:"airline_update",PLACE_LIST:"place_list",AIRLINE_CHECKIN_REMINDER:"airline_checkin_reminder"};},null);
__d('BlueBarMinWidthWithJewel',['BlueBar','DOMEventListener','DOMQuery','Locale','csx','getElementPosition','getStyleProperty','getViewportDimensions','queryThenMutateDOM'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();g.init=function(){var q=h.getNavRoot();if(!q)return;var r=j.scry(q,"._fmc")[0];if(!r)return;var s=function(){return p(function(){var t=m(q),u=t.x,v=t.width,w=undefined;if(k.isRTL()){w=-u;}else{var x=o().width;w=2*u+v-x;}if(w>0){var y=parseInt(n(q,'width'),10),z=y-w;if(z>0)return z+'px';}return '';},function(t){r.style.width=t;},'BlueBarMinWidthWithJewel');};i.add(window,'resize',s);s();};},null);
__d('PagesMessengerThreadUtils',['MessagingTag','PageMessageEnumTag','invariant'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k='CUSTOM_TAG_',l={isFlagThread:function(m){if(m&&m.page_thread_info&&'flagged' in m.page_thread_info)return m.page_thread_info.flagged;return false;},isPageSpecficEnumFilter:function(m){if(m===i.FLAG)return true;return false;},isCustomTagsFilter:function(m){return m.startsWith(k);},getCustomTagsFilter:function(m){return k+JSON.stringify(m.sort());},parseCustomTagsFilter:function(m){if(!this.isCustomTagsFilter(m))j(0);return JSON.parse(m.substring(k.length));},getBatchActionMenuParam:function(m){var n=false,o=false,p=false,q=false,r=false,s=false,t=false,u=false,v=false;if(m.folder===h.INBOX&&!m.is_archived){n=true;q=true;if(l.isFlagThread(m)){t=true;}else s=true;if(m&&m.unread_count===0){v=true;}else u=true;}else if(m.folder===h.SPAM){r=true;}else if(m.is_archived){o=true;p=true;}if(m&&m.unread_count===0){v=true;}else u=true;return {showArchive:n,showDelete:o,showUnarchive:p,showSpam:q,showUnspam:r,showFlag:s,showUnflag:t,showMarkRead:u,showMarkUnread:v,showHideContextCard:false,showShowContextCard:false};}};f.exports=l;},null);
__d('MercurySingletonProvider',['CurrentUser','Map'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();function j(k){this.$MercurySingletonProvider1=new i();this.$MercurySingletonProvider2=k;}j.prototype.getForFBID=function(k){if(!this.$MercurySingletonProvider1.has(k))this.$MercurySingletonProvider1.set(k,new this.$MercurySingletonProvider2(k));return this.$MercurySingletonProvider1.get(k);};j.prototype.get=function(){return this.getForFBID(h.getID());};j.mock=function(k){throw new Error('MercurySingletonProvider.mock() must only be used in tests.');};f.exports=j;},null);
__d('MercuryAssert',['MercuryIDs'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();f.exports={isParticipantID:function(i){if(!h.isValid(i))throw 'bad_participant_id '+i;},allParticipantIDs:function(i){i.forEach(this.isParticipantID);},isUserParticipantID:function(i){var j=h.tokenize(i);if(j.type!='fbid')throw 'bad_user_id '+i;},isEmailParticipantID:function(i){var j=h.tokenize(i);if(j.type!='email')throw 'bad_email_id '+i;},allThreadID:function(i){i.forEach(this.isThreadID);},isThreadID:function(i){if(!h.isValid(i))throw 'bad_thread_id '+i;}};},null);
__d('MercurySingletonMixin',['CurrentUser'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={_getInstances:function(){if(!this._instances)this._instances={};return this._instances;},get:function(){return this.getForFBID(h.getID());},getForFBID:function(j){var k=this._getInstances();if(!k[j])k[j]=new this(j);return k[j];}};f.exports=i;},null);
__d('MercuryThreadInformer',['ArbiterMixin','LogHistory','MercuryAssert','MercurySingletonMixin','mapObject','mixin'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n,o;'use strict';var p=i.getInstance('mercury_informer');n=babelHelpers.inherits(q,m(h));o=n&&n.prototype;function q(r){o.constructor.call(this);this.$MercuryThreadInformer1=r;this.$MercuryThreadInformer2={};this.$MercuryThreadInformer3={};this.$MercuryThreadInformer4={};this.$MercuryThreadInformer5=false;this.$MercuryThreadInformer6=false;this.$MercuryThreadInformer7=false;this.$MercuryThreadInformer8={};this.$MercuryThreadInformer9={};this.$MercuryThreadInformer10={};this.$MercuryThreadInformer11=0;}q.prototype.updatedThread=function(r){this.$MercuryThreadInformer3[r]=true;this.$MercuryThreadInformer12();};q.prototype.deletedThread=function(r){this.$MercuryThreadInformer2[r]=true;this.$MercuryThreadInformer12();};q.prototype.updatedThreadlist=function(){this.$MercuryThreadInformer5=true;this.$MercuryThreadInformer12();};q.prototype.updatedUnseenState=function(){this.$MercuryThreadInformer6=true;this.$MercuryThreadInformer12();};q.prototype.updatedUnreadState=function(){this.$MercuryThreadInformer7=true;this.$MercuryThreadInformer12();};q.prototype.changedThreadReadState=function(r,s,t){if(!this.$MercuryThreadInformer4[r]||this.$MercuryThreadInformer4[r].timestamp<t)this.$MercuryThreadInformer4[r]={mark_as_read:s,timestamp:t};this.$MercuryThreadInformer12();};q.prototype.receivedMessage=function(r){j.isThreadID(r.thread_id);var s=r.thread_id;if(!this.$MercuryThreadInformer8[s])this.$MercuryThreadInformer8[s]=[];this.$MercuryThreadInformer8[s].push(r);this.updatedThread(s);};q.prototype.reorderedMessages=function(r,s){this.$MercuryThreadInformer9[r]={source:s};this.$MercuryThreadInformer12();};q.prototype.updatedMessage=function(r,s,t){if(!this.$MercuryThreadInformer10[r])this.$MercuryThreadInformer10[r]={};this.$MercuryThreadInformer10[r][s]={source:t};this.updatedThread(r);};q.prototype.synchronizeInforms=function(r){this.$MercuryThreadInformer11++;try{r();}catch(s){throw s;}finally{this.$MercuryThreadInformer11--;this.$MercuryThreadInformer12();}};q.prototype.listen=function(r,s){return this.subscribe('threads-updated',function(t,u){if(u[r])s(r);});};q.prototype.$MercuryThreadInformer12=function(){if(!this.$MercuryThreadInformer11){var r=this.$MercuryThreadInformer2,s=this.$MercuryThreadInformer3,t=this.$MercuryThreadInformer4,u=this.$MercuryThreadInformer5,v=this.$MercuryThreadInformer6,w=this.$MercuryThreadInformer7,x=this.$MercuryThreadInformer8,y=this.$MercuryThreadInformer9,z=this.$MercuryThreadInformer10;this.$MercuryThreadInformer2={};this.$MercuryThreadInformer3={};this.$MercuryThreadInformer4={};this.$MercuryThreadInformer5=false;this.$MercuryThreadInformer6=false;this.$MercuryThreadInformer7=false;this.$MercuryThreadInformer8={};this.$MercuryThreadInformer9={};this.$MercuryThreadInformer10={};var aa=Object.keys(s);if(aa.length||u)this.inform('threadlist-updated',aa);if(aa.length)this.$MercuryThreadInformer13('threads-updated',s);for(var ba in t){this.$MercuryThreadInformer13('thread-read-changed',t);break;}for(ba in r){this.$MercuryThreadInformer13('threads-deleted',r);break;}if(v)this.$MercuryThreadInformer13('unseen-updated',null);if(w)this.$MercuryThreadInformer13('unread-updated',null);for(ba in x){this.$MercuryThreadInformer13('messages-received',x);break;}for(ba in y){this.$MercuryThreadInformer13('messages-reordered',y);break;}for(ba in z){this.$MercuryThreadInformer13('messages-updated',z);break;}}};q.prototype.$MercuryThreadInformer13=function(r,s){p.debug(r,'{}');this.inform(r,s);};Object.assign(q,k);f.exports=q;},null);
__d('MercuryDispatcher',['ArbiterMixin','LogHistory','MercuryLoggingHelper','MercuryPayloadSource','MercurySingletonProvider','MercuryThreadInformer','invariant','isEmpty','mixin'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q,r;'use strict';var s=i.getInstance('mercury_dispatcher');q=babelHelpers.inherits(t,p(h));r=q&&q.prototype;t.getForFBID=function(v){return u.getForFBID(v);};t.get=function(){return u.get();};function t(v){r.constructor.call(this);this.$MercuryDispatcher1=v;}t.prototype.handleUpdate=function(v){this.$MercuryDispatcher2(v);!(!!v.from_client!==!!v.preprocessed)?n(0):undefined;delete v.preprocessed;if(!o(v))m.getForFBID(this.$MercuryDispatcher1).synchronizeInforms((function(){if(v.payload_source===k.SERVER_INVALIDATE_GLOBAL_STATE)this.inform('invalidate-global-state',{});if(v.payload_source===k.SERVER_INVALIDATE_THREAD_STATE){var w=v.threads&&v.threads.length>0&&v.threads[0]&&v.threads[0].thread_id;if(w)this.inform('invalidate-thread-state',w);}if(!v.from_client)this.inform('payload-preprocessed',v);this.inform('update-thread-ids',v.newlyAddedClientIDs||{});this.inform('update-participants',v);this.inform('update-threads',v);this.inform('update-unread',v);this.inform('update-threadlist',v);this.inform('update-pinned-threads',v);this.inform('update-messages',v);this.inform('update-unseen',v);this.inform('update-typing-state',v);this.inform('update-delivery',v);this.inform('update-roger',v.roger);this.inform('update-blocked-users',v);this.inform('model-update-completed',null);}).bind(this));};t.prototype.$MercuryDispatcher2=function(v){var w={actions:[],threads:[]};if(v){if(v.actions)w.actions=v.actions.map(function(z){return j.obfuscateMessage(z);});if(v.threads)w.threads=v.threads.map(function(z){return j.obfuscateThread(z);});}var x=Object.assign({},v,w),y=v.payload_source;if(y!==k.CLIENT_CHANGE_READ_STATUS&&y!==k.CLIENT_MARK_THREAD_SEEN)s.debug('update:'+y,JSON.stringify({from_client:v.from_client}));};var u=new l(t);f.exports=t;},null);
__d('MercuryFolders',['MessagingTag'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=[h.INBOX,h.PENDING,h.OTHER,h.ACTION_ARCHIVED],j={getSupportedFolders:function(){return i.concat();},getFromMeta:function(k){var l=k.folder;if(k.is_archived)l=h.ACTION_ARCHIVED;return l;}};f.exports=j;},null);
__d('MercuryServerRequestSingletonMixin',['CurrentUser','FBID'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={_getInstances:function(){if(!this._instances)this._instances={};return this._instances;},get:function(){return this.getForFBID(h.getID());},getForFBID:function(k){var l=this._getInstances();if(!l[k])if(i.isUser(k)){l[k]=new this(k);}else{var m;e(['MercuryPageServerRequests'],function(n){m=new n(k);});l[k]=m;}return l[k];}};f.exports=j;},null);
__d('MercuryPageServerRequests',['MercuryAPIArgsSource','MercuryAssert','MercuryServerRequests','PageMessageEnumTag','PagesMessengerThreadUtils','MercuryServerDispatcher'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n,o,p=h.MERCURY;n=babelHelpers.inherits(q,j);o=n&&n.prototype;function q(r){'use strict';o.constructor.call(this,r);var s={'/pages/messaging/thread_tag/add/':{request_user_id:r,mode:m.BATCH_SUCCESSIVE,batch_function:this.$MercuryPageServerRequests1,handler:(function(t,u){return this.__handleUpdate(t,u);}).bind(this)},'/pages/messaging/thread_tag/remove/':{request_user_id:r,mode:m.BATCH_SUCCESSIVE,batch_function:this.$MercuryPageServerRequests1,handler:(function(t,u){return this.__handleUpdate(t,u);}).bind(this)},'/pages/messaging/thread_tag/list/':{request_user_id:r,mode:m.IMMEDIATE,handler:(function(t,u){return this.__handleUpdate(t,u);}).bind(this)},'/pages/messaging/thread_custom_tags/list/':{request_user_id:r,mode:m.IMMEDIATE,handler:(function(t,u){return this.__handleUpdate(t,u);}).bind(this)},'/pages/messaging/create_note/':{request_user_id:r,mode:m.IMMEDIATE,handler:(function(t,u){return this.__handleUpdate(t,u);}).bind(this)}};m.registerEndpoints(s);}q.prototype.$MercuryPageServerRequests1=function(r,s){'use strict';var t=r?r.tag_name:s.tag_name,u=r?r.thread_ids:[],v=s?s.thread_ids:[],w=u.concat(v),x={tag_name:t,thread_ids:w};return x;};q.prototype.addThreadFlag=function(r,s){'use strict';i.isThreadID(r);this.__threadIDMap.getServerIDFromClientID(r,(function(t){var u={thread_ids:[t],tag_name:k.FLAG};this.__sendRequest('/pages/messaging/thread_tag/add/',u);}).bind(this));};q.prototype.createNote=function(r,s,t){'use strict';i.isThreadID(t);this.__threadIDMap.getServerIDFromClientID(t,(function(u){var v={body:r,message_id:s,other_user_fbid:u};this.__sendRequest('/pages/messaging/create_note/',v);}).bind(this));};q.prototype.fetchThreadlistInfo=function(r,s,t,u,v){'use strict';var w={folder:t,offset:r,limit:s};if(l.isPageSpecficEnumFilter(u)){v=v||p;w.tag_name=u;this.__sendRequest('/pages/messaging/thread_tag/list/',w);return;}if(u&&l.isCustomTagsFilter(u)){w.custom_tags_filter=u;w.custom_tags=l.parseCustomTagsFilter(u);this.__sendRequest('/pages/messaging/thread_custom_tags/list/',w);return;}o.fetchThreadlistInfo.call(this,r,s,t,u,v);};q.prototype.removeThreadFlag=function(r,s){'use strict';i.isThreadID(r);this.__threadIDMap.getServerIDFromClientID(r,(function(t){var u={thread_ids:[t],tag_name:k.FLAG};this.__sendRequest('/pages/messaging/thread_tag/remove/',u);}).bind(this));};q.prototype.toString=function(){'use strict';return 'MercuryPageServerRequests';};f.exports=q;},null);
__d('EmojiLikeConstants',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={SMALL:'small',MEDIUM:'medium',LARGE:'large'},i='hot_emoji_size',j='emoji_like',k='\uD83D\uDC4D';f.exports={size:h,TAG_PREFIX_NEW:i,TAG_PREFIX_OLD:j,THUMBS_UP_EMOJI:k};},null);
__d('MercuryTagHelper',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={get:function(i,j){var k=i.find(function(l){return l.startsWith(j);});return k&&k.substr(k.indexOf(':')+1);}};f.exports=h;},null);
__d('EmojiLikeUtils',['EmoticonsList','EmojiLikeConstants','MercuryConfig','MercuryTagHelper','SupportedEmoji','Utf16'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n,o;'use strict';var p=i.size,q='/images/emoji/unicode/emoji_',r='/images/emoticons/',s=(n={},n[p.SMALL]='_16-2x',n[p.MEDIUM]='_64',n[p.LARGE]='_64',n),t=(o={},o[p.MEDIUM]='-2x',o),u='.png',v='emoji',w='emoticon',x=new RegExp('([\u203C\u2049\u2100-\u21FF\u2300-\u27FF'+'\u2900-\u29FF\u2B00-\u2BFF\u3000-\u30FF\u3200-\u32FF]|'+'\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDEFF])([\uFE00-\uFE0F])?'),y=function(fa){if(!j.BubblelessEmojiRenderingGK)return false;var ga=fa||'',ha=[],ia=null;while(ga.length>0){ga=ga.trim();if(h.noncapturingRegexp.test(ga)){ia=h.noncapturingRegexp.exec(ga);ha.push({type:w,title:ia[1],id:h.emotes[ia[1]]});ga=ga.replace(h.noncapturingRegexp,'');}else if(x.test(ga)){var ja=x.exec(ga);if(!ja||!ja.length)return false;ia=ja[1];var ka=m.decode(ia),la=l.emoji[ka];if(!la)return false;ha.push({type:v,id:ka.toString(16)});ga=ga.replace(x,'');}else return false;}return ha;};function z(fa,ga){fa.tags=[aa(ga)];return fa;}function aa(fa){var ga=j.WWWMessengerNewEmojiSizeTagGK?i.TAG_PREFIX_NEW:i.TAG_PREFIX_OLD;return ga+':'+fa;}function ba(fa){return ca(fa)!=null;}function ca(fa){if(!fa.tags)return null;var ga=k.get(fa.tags,i.TAG_PREFIX_NEW);if(ga)return ga;return k.get(fa.tags,i.TAG_PREFIX_OLD);}function da(fa,ga){return (q+m.decode(fa).toString(16)+s[ga]+u);}function ea(fa){var ga=p.LARGE,ha=p.MEDIUM,ia=[];if(fa)fa.forEach(function(ja){if(ja.type===v){ia.push({type:ja.type,title:undefined,url:q+ja.id+s[ga]+u});}else ia.push({type:ja.type,title:ja.title,url:r+ja.id+t[ha]+u});});return ia;}f.exports={getEmojiSize:ca,getURI:da,getSourceURIs:ea,isEmojiLike:ba,richContent:y,setEmojiSize:z,EMOJI_TYPE:v,EMOTE_TYPE:w};},null);
__d('MercuryAttachment',['EmojiLikeUtils','MercuryAttachmentContentType','MercuryAttachmentType','MercuryAudioType','MercuryTagHelper','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n={getAttachIconClass:function(o){switch(o){case i.PHOTO:return "_y2-";case i.VIDEO:return "_y2_";case i.MUSIC:return "_y30";case i.VOICE:return "_y31";case i.TEXT:return "_y32";case i.MSWORD:return "_y33";case i.MSXLS:return "_y34";case i.MSPPT:return "_y35";}return "_y36";},getAttachIconClassByMime:function(o){if(o.startsWith('image')){return "_y2-";}else if(o.startsWith('video')){return "_y2_";}else if(o.startsWith('audio')){return "_y30";}else if(o.startsWith('text/plain')){return "_y32";}else return "_y36";},getAttachTypeByMime:function(o){if(o.startsWith('image')){return i.PHOTO;}else if(o.startsWith('video')){return i.VIDEO;}else if(o.startsWith('audio')){return i.MUSIC;}else if(o.startsWith('text/plain')){return i.TEXT;}else return i.UNKNOWN;},convertRaw:function(o){var p=[];for(var q=0;q<o.length;q++){var r=o[q];if(r.attach_type===j.PHOTO){p.push(r);}else if(r.filename){var s=n.getAttachTypeByMime(r.filetype),t={};t.attach_type=j.FILE;t.name=r.filename;t.icon_type=s;t.url='';p.push(t);}}return p;},get:function(o){var p=[];if(o.attachments){p=o.attachments;}else if(o.raw_attachments)p=this.convertRaw(o.raw_attachments);var q=h.getEmojiSize(o);if(q)p=p.concat([{attach_type:j.EMOJI_LIKE,size:q}]);if(!(o.attachments&&o.attachments.length>0)){if(o.sticker_id)return p.concat([{attach_type:j.STICKER}]);if(o.preview_attachments&&o.preview_attachments.length>0)return p.concat(o.preview_attachments);}return p;},resizeContain:function(o,p){var q=o.width/o.height,r=p.width/p.height;if(r<q){return {width:Math.ceil(Math.min(o.height*r,p.width)),height:Math.ceil(Math.min(o.height,p.height))};}else return {width:Math.ceil(Math.min(o.width,p.width)),height:Math.ceil(Math.min(o.width/r,p.height))};},isBubblePreferred:function(o){return !(this.isPhotoAttachment(o)||this.isStickerAttachment(o)||this.isVideoAttachment(o)||this.isVoiceAttachment(o));},isEphemeralAttachmentStyle:function(o){return (this.isPhotoAttachment(o)||this.isVideoAttachment(o));},isEphemeralTextStyle:function(o){return (this.isErrorAttachment(o)||this.isShareAttachment(o)||this.isFileAttachment(o));},isPhotoAttachment:function(o){return !!(o.attach_type==j.PHOTO||o.attach_type==j.ANIMATED_IMAGE||o.attach_type==j.FILE&&o.preview_url);},isVideoAttachment:function(o){return o.attach_type==j.VIDEO;},isShareAttachment:function(o){return o.attach_type==j.SHARE;},isFileAttachment:function(o){return o.attach_type==j.FILE;},isErrorAttachment:function(o){return o.attach_type==j.ERROR;},isStickerAttachment:function(o){return o.attach_type==j.STICKER;},isEmojiLikeAttachment:function(o){return o.attach_type===j.EMOJI_LIKE;},isVoiceAttachment:function(o){if(!o.metadata)return false;return (o.metadata.type===k.AudioClip||o.metadata.type===k.VoiceMessageWithTranscript);},hasAttribution:function(o){return !!o.app_attribution;}};f.exports=n;},null);
__d('MercuryServerPayloadPreprocessor',['CurrentEnvironment','MercuryIDs','MercuryConfig','MercuryActionStatus','MercuryActionType','MercuryAttachment','MercuryDispatcher','MercurySendErrorLogger','MercurySingletonMixin','MercuryThreadIDMap','StoryAttachmentStyle','invariant','URI'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){'use strict';if(c.__markCompiled)c.__markCompiled();function u(v){this.$MercuryServerPayloadPreprocessor1=v;this.$MercuryServerPayloadPreprocessor2=q.getForFBID(this.$MercuryServerPayloadPreprocessor1);this.$MercuryServerPayloadPreprocessor3=n.getForFBID(this.$MercuryServerPayloadPreprocessor1);}u.prototype.handleUpdate=function(v){var w={};!!v.from_client?s(0):undefined;(v.threads||[]).forEach((function(oa){this.$MercuryServerPayloadPreprocessor4(oa,w);var pa=this.$MercuryServerPayloadPreprocessor2.getServerIDFromClientIDNow(oa.thread_id);e(['MercuryServerRequests'],(function(qa){var ra=qa.getForFBID(this.$MercuryServerPayloadPreprocessor1);ra.markThreadFetched(oa.thread_id);ra.markThreadFetched(pa);ra.updateLastActionTimestamp(oa.timestamp);}).bind(this));}).bind(this));(v.ordered_threadlists||[]).forEach((function(oa){var pa=oa.thread_fbids||[];pa=pa.concat(oa.other_user_fbids||[]);oa.thread_ids=pa.map((function(qa){return this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(qa.toString());}).bind(this));}).bind(this));if(v.pinned_threads&&v.pinned_threads.thread_fbids)v.pinned_threads.thread_fbids=v.pinned_threads.thread_fbids.map((function(oa){return this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(oa);}).bind(this));if(v.delivery_receipts){var x={};for(var y=v.delivery_receipts,z=Array.isArray(y),aa=0,y=z?y:y[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var ba;if(z){if(aa>=y.length)break;ba=y[aa++];}else{aa=y.next();if(aa.done)break;ba=aa.value;}var ca=ba,da=ca.other_user_fbid?i.getThreadIDFromUserID(ca.other_user_fbid):this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(ca.thread_fbid);x[da]=ca.time;}v.delivery_receipts=x;}v.actions=v.actions||[];v.actions.forEach((function(oa){if(oa.action_type===l.SEND_MESSAGE&&oa.status===k.ERROR)o.log(oa);var pa=null,qa=null;if(oa.other_user_fbid){qa=i.getThreadIDFromUserID(oa.other_user_fbid);pa=oa.other_user_fbid;}else if(oa.thread_fbid){qa=i.getThreadIDFromThreadFBID(oa.thread_fbid);pa=oa.thread_fbid;}else if(oa.thread_id){qa=i.getThreadIDFromThreadFBID(oa.thread_id);pa=oa.thread_id;}else if(oa.status&&oa.status!=k.SUCCESS&&oa.client_thread_id){qa=oa.client_thread_id;}else s(0);pa=pa&&pa.toString();oa.thread_id=this.$MercuryServerPayloadPreprocessor2.hasClientIDForServerID(pa)?this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(pa):qa;if(oa.action_type==l.SEND_MESSAGE&&oa.client_thread_id&&pa){oa.thread_id=oa.client_thread_id;this.$MercuryServerPayloadPreprocessor2.forceSetServerIDToClientID(pa,oa.client_thread_id);w[pa]=oa.client_thread_id;}!oa.thread_id?s(0):undefined;if(!v.payload_source||!v.payload_source.startsWith('server'))e(['MercuryServerRequests'],(function(ra){ra.getForFBID(this.$MercuryServerPayloadPreprocessor1).updateLastActionTimestamp(oa.timestamp);}).bind(this));}).bind(this));this.$MercuryServerPayloadPreprocessor5(v);this.$MercuryServerPayloadPreprocessor6(v);if(v.end_of_history){var ea=[];for(var fa=0;fa<v.end_of_history.length;fa++){var ga=v.end_of_history[fa];if(ga.type=='user'){ea.push('user:'+ga.fbid);}else if(ga.type=='thread'&&this.$MercuryServerPayloadPreprocessor2.hasClientIDForServerID(ga.fbid))ea.push(this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(ga.fbid));}v.end_of_history=ea;}if(v.roger){var ha={};for(var ia in v.roger){var ja=Object.keys(v.roger[ia]),ka;if(ia){ka=this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(ia);}else if(ja.length===1)ka=i.getThreadIDFromUserID(ja[0]);if(ka){var la=v.roger[ia];ha[ka]={};for(var ma in la)if(la.hasOwnProperty(ma)){var na=i.getParticipantIDFromUserID(ma);ha[ka][na]=la[ma];}}}v.roger=ha;}v.newlyAddedClientIDs=w;v.preprocessed=true;this.$MercuryServerPayloadPreprocessor3.handleUpdate(v);};u.prototype.$MercuryServerPayloadPreprocessor4=function(v,w){var x=v.other_user_fbid?v.other_user_fbid:v.thread_fbid;!x?s(0):undefined;var y=this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(x);if(!y){y=v.other_user_fbid?i.getThreadIDFromUserID(v.other_user_fbid):i.getThreadIDFromThreadFBID(v.thread_fbid);this.$MercuryServerPayloadPreprocessor2.setServerIDToClientID(x,y);this.$MercuryServerPayloadPreprocessor2.setDeprecatedServerIDToClientID(v.thread_id,y);w[x]=y;}v.thread_id=y;};u.prototype.$MercuryServerPayloadPreprocessor5=function(v){v.actions.forEach(function(w){if(w.action_type===l.USER_GENERATED_MESSAGE){w.attachments=w.attachments||[];w.attachments.forEach(function(x){if(m.isShareAttachment(x)&&h.messengerdotcom){var y=new t(x.share.uri);if(!y.getDomain())x.share.uri=y.setDomain('facebook.com').setSubdomain(t.getRequestURI().getSubdomain()).setProtocol('https').toString();}});}});};u.prototype.$MercuryServerPayloadPreprocessor6=function(v){if(!j.MercuryGenieRendering)return;v.actions.forEach(function(w){if(w.action_type!==l.USER_GENERATED_MESSAGE)return;var x=w;if(!x.has_attachment||!x.attachments)return;for(var y=x.attachments.length-1;y>=0;y-=1){var z=x.attachments[y];if(!z.share||!z.share.style_list||z.share.style_list[0]!=r.GENIE_MESSAGE)continue;if(z.share.target.genie_id)x.author=i.getParticipantIDFromUserID(z.share.target.genie_id);if(z.share.target&&!z.share.target.attachment){x.attachments.splice(y,1);x.has_attachment=x.attachments.length>0;}}});};Object.assign(u,p);f.exports=u;},null);
__d('MercuryMessageClientState',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={DO_NOT_SEND_TO_SERVER:'do_not_send_to_server',SEND_TO_SERVER:'send_to_server'};f.exports=h;},null);
__d('MercuryMessageIDs',['KeyedCallbackManager'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=new h(),j={getServerIDs:function(k,l){var m=k.filter(function(o){return o.indexOf('id')===-1;}),n=function(o){var p=k.map(function(q){return o[q]?o[q]:q;});l(p);};return i.executeOrEnqueue(m,n);},addServerID:function(k,l){i.setResource(k,l);}};f.exports=j;},null);
__d("MercuryServerSendMessageQueueOptions",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j,k,l,m,n){"use strict";this.success_handler=i;this.error_handler=j;this.transport_error_handler=k;this.timeout_handler=l;this.timeout=m;this.connection_retries=n;}f.exports=h;},null);
__d('MercuryServerSendMessageQueueSimulatedError',['AsyncRequest','AsyncResponse'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=9999,k={create:function(l){var m=new h(this.endpoint_uri).setData({message_batch:[l],client:this.client}),n=new i(m,{});Object.assign(n,{error:j,silentError:false,transientError:true,request:m});return n;}};f.exports=k;},null);
__d('MercuryServerSendMessageQueue',['BanzaiODS','LogHistory','MercuryLoggingHelper','MercuryServerRequestsConfig','MercuryServerDispatcher','MercuryServerSendMessageQueueSimulatedError'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n='/ajax/mercury/send_messages.php',o=i.getInstance('mercury_server_send_message_queue');function p(q,r,s,t){'use strict';this.sender_id=q;this.queue_id=r;this.$MercuryServerSendMessageQueue1=s.success_handler;this.$MercuryServerSendMessageQueue2=s.error_handler;this.$MercuryServerSendMessageQueue3=s.transport_error_handler;this.$MercuryServerSendMessageQueue4=s.timeout_handler;this.client=t;var u=null;if(k.msgrRegion)u={name:'X-MSGR-Region',value:k.msgrRegion};var v={};v[n]={request_user_id:this.sender_id,endpoint_id:this.queue_id,mode:l.IMMEDIATE,customHeader:u,handler:this.handleSuccess.bind(this),error_handler:this.handleError.bind(this),transport_error_handler:this.handleTransportError.bind(this),timeout:s.timeout,timeout_handler:this.handleTimeout.bind(this),connection_retries:s.connection_retries};l.registerEndpoints(v);this.pending_message=null;this.queue=[];}p.prototype.enqueue=function(q){'use strict';this.queue.push(q);this.$MercuryServerSendMessageQueue5();};p.prototype.$MercuryServerSendMessageQueue5=function(){'use strict';if(this.pending_message||!this.queue.length){if(this.pending_message)this.$MercuryServerSendMessageQueue6();return;}this.pending_message=this.queue.shift();l.trySend(n,{message_batch:[this.pending_message],client:this.client},null,this.sender_id,this.queue_id);};p.prototype.$MercuryServerSendMessageQueue7=function(){'use strict';while(this.queue.length)this.$MercuryServerSendMessageQueue8(this.queue.shift());};p.prototype.$MercuryServerSendMessageQueue8=function(q){'use strict';this.$MercuryServerSendMessageQueue2(m.create(q));o.error('mark_as_failed',JSON.stringify({fbid:this.sender_id,queue_id:this.queue_id,message:j.obfuscateMessage(q)}));};p.prototype.handleSuccess=function(q,r){'use strict';this.$MercuryServerSendMessageQueue1(q,r);this.pending_message=null;this.$MercuryServerSendMessageQueue5();};p.prototype.handleError=function(q){'use strict';this.$MercuryServerSendMessageQueue2(q);this.$MercuryServerSendMessageQueue7();this.pending_message=null;};p.prototype.handleTransportError=function(q){'use strict';this.$MercuryServerSendMessageQueue3(q);this.$MercuryServerSendMessageQueue7();this.pending_message=null;};p.prototype.handleTimeout=function(q){'use strict';this.$MercuryServerSendMessageQueue4(q);this.$MercuryServerSendMessageQueue7();this.pending_message=null;};p.prototype.$MercuryServerSendMessageQueue6=function(){'use strict';o.debug('maybe_send_next_pending_message',JSON.stringify({fbid:this.sender_id,queue_id:this.queue_id,pending_message:j.obfuscateMessage(this.pending_message),queue:this.queue.map(function(r){return j.obfuscateMessage(r);})}));var q='send_queue.delayed.queue_length.'+this.queue.length.toString();h.bumpEntityKey('chat.web',q);};f.exports=p;},null);
__d('MercuryServerSendMessageQueueRouter',['BanzaiODS','LogHistory','Map','MercuryServerSendMessageQueue','MercurySingletonMixin'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=i.getInstance('mercury_server_send_message_queue_router'),n='chat.web.send_queue_router';h.setEntitySample(n,.1);function o(p){'use strict';this.fbid=p;this.queues=new j();}o.prototype.enqueue=function(p,q,r,s){'use strict';if(!this.queues.has(p)){this.queues.set(p,new k(this.fbid,p,q,r));m.debug('added queue',JSON.stringify({fbid:this.fbid,queue_id:p}));h.bumpEntityKey(n,'new_queue');}this.queues.get(p).enqueue(s);};Object.assign(o,l);f.exports=o;},null);
__d('MercuryServerRequests',['Arbiter','AsyncResponse','BanzaiODS','ChannelConstants','CurrentUser','LogHistory','MercuryActionStatus','MercuryActionType','MercuryAPIArgsSource','MercuryAssert','MercuryDispatcher','MercuryThreadIDMap','MercuryErrorType','MercuryGlobalActionType','MercuryIDs','MercuryLogMessageType','MercuryMessageClientState','MercuryPayloadSource','MercurySendErrorLogger','MercuryServerPayloadPreprocessor','MercuryServerRequestsConfig','MercuryServerSendMessageQueueRouter','MercuryServerRequestSingletonMixin','MercurySourceType','MercuryThreadlistConstants','MercuryMessageIDs','MessagingConfig','MessagingTag','MercuryServerDispatcher','MercuryServerSendMessageQueueOptions','createObjectFrom','errorCode','invariant','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa){'use strict';if(c.__markCompiled)c.__markCompiled();var pa=m.getInstance('mercury_server'),qa=p.MERCURY,ra=1000;function sa(cb){return cb.getError()?'_'+cb.getError():'';}function ta(cb,db){var eb=babelHelpers._extends({},cb),fb;if(db.threads){if(!eb.threads)eb.threads={};for(fb in db.threads)eb.threads[fb]=Object.keys(la((eb.threads[fb]||[]).concat(db.threads[fb])));}if(db.messages){if(!eb.messages)eb.messages={};for(fb in db.messages){if(!eb.messages[fb])eb.messages[fb]={};for(var gb in db.messages[fb])if(eb.messages[fb][gb]){eb.messages[fb][gb]=xa(eb.messages[fb][gb],db.messages[fb][gb]);}else eb.messages[fb][gb]=db.messages[fb][gb];}}eb.client=cb.client||db.client;return eb;}function ua(cb,db){var eb=Object.assign(la(cb.folders,true),la(db.folders,true)),fb=cb.client||db.client;return {folders:Object.keys(eb),client:fb};}function va(cb,db){for(var eb in db)if(cb[eb]&&typeof cb[eb]==='object'){cb[eb]=xa(cb[eb],db[eb]);}else if(db[eb]&&typeof db[eb]==='object'){var fb={};Object.assign(fb,db[eb]);cb[eb]=fb;}return cb;}function wa(cb,db){return db;}function xa(cb,db){var eb=cb.offset<db.offset?cb.offset:db.offset,fb=cb.offset+cb.limit,gb=db.offset+db.limit,hb=fb>gb?fb:gb,ib=hb-eb,jb=cb.timestamp>db.timestamp?cb.timestamp:db.timestamp;return {offset:eb,limit:ib,timestamp:jb};}function ya(cb,db){var eb=cb.client||db.client,fb={ids:{},client:eb};Object.assign(fb.ids,cb.ids,db.ids);return fb;}function za(cb,db){var eb={},fb,gb=cb.client||db.client;delete cb.client;delete db.client;for(fb in cb)Object.assign(eb,la(cb[fb],fb));for(fb in db)Object.assign(eb,la(db[fb],fb));var hb={client:gb};for(var ib in eb){fb=eb[ib];if(!hb[fb])hb[fb]=[];hb[fb].push(ib);}return hb;}function ab(cb,db){var eb=cb.client||db.client,fb=la(cb.ids,true),gb=la(db.ids,true),hb=Object.assign(fb,gb);return {ids:Object.keys(hb),client:eb};}function bb(cb){this._fbid=cb;this._lastActionTimestamp=0;this._fetchingThreads={};this._sentMessagesTimestamp={};this.__threadIDMap=s.getForFBID(this._fbid);this._dispatcher=r.getForFBID(this._fbid);this._payloadPreprocessor=aa.getForFBID(this._fbid);this._sendMessageQueueOptions=new ka((function(db,eb){return this.__handleUpdate(db,eb);}).bind(this),(function(db){return this._handleSendMessageError(db);}).bind(this),(function(db){return this._handleSendMessageTransportError(db);}).bind(this),(function(db){return this._handleSendMessageTimeout(db);}).bind(this),ba.sendMessageTimeout,ha.SEND_CONNECTION_RETRIES);this._registerEndpoints();}Object.assign(bb.prototype,{fetchThreadlistInfo:function(cb,db,eb,fb,gb){eb=eb||ia.INBOX;gb=gb||qa;var hb=fb?ja.IMMEDIATE:null,ib={client:gb};ib[eb]={offset:cb,limit:db,filter:fb};this.__sendRequest('/ajax/mercury/threadlist_info.php',ib,hb);},fetchPinnedThreads:function(){this.__sendRequest('/mercury/pinned_threads/',{});},fetchUnseenThreadIDs:function(cb,db){db=db||qa;this.fetchThreadlistInfo(fa.RECENT_THREAD_OFFSET,fa.JEWEL_THREAD_COUNT,cb,null,db);},fetchUnreadThreadIDs:function(cb,db){db=db||qa;this.__sendRequest('/ajax/mercury/unread_threads.php',{folders:[cb],client:db});},fetchMissedMessages:function(cb,db,eb){db=db||qa;var fb={last_action_timestamp:eb||this._lastActionTimestamp,folders:cb,client:db};setTimeout((function(){this.__sendRequest('/ajax/mercury/thread_sync.php',fb);}).bind(this),ra);},fetchThreadData:function(cb,db){db=db||qa;q.allThreadID(cb);var eb={threads:{},client:db},fb=[],gb=[];cb.forEach((function(ib){if(this._fetchingThreads[ib])return;this._fetchingThreads[ib]=true;var jb=this.__threadIDMap.getServerIDFromClientIDNow(ib),kb=v.tokenize(ib);if(kb.type=='user'){fb.push(kb.value);eb.threads.user_ids=fb;}else if(kb.type=='thread'){if(jb){gb.push(jb);}else gb.push(kb.value);eb.threads.thread_fbids=gb;}else if(kb.type=='root'){if(jb){gb.push(jb);eb.threads.thread_fbids=gb;}}else if(kb.type!='pending')throw new Error('Unknown thread type',kb);}).bind(this));this._dispatcher.inform("fetch-thread-data",eb);for(var hb in eb.threads){this.__sendRequest('/ajax/mercury/thread_info.php',eb);break;}},ensureThreadIsFetched:function(cb,db){db=db||qa;if(!this.__threadIDMap.getClientIDFromServerIDNow(cb)&&!this._fetchingThreads[cb]){this._fetchingThreads[cb]=true;this.__sendRequest('/ajax/mercury/thread_info.php',{threads:{thread_fbids:[cb]},client:db});}},fetchThreadMessages:function(cb,db,eb,fb,gb,hb){q.isThreadID(cb);hb=hb||qa;var ib,jb,kb=v.tokenize(cb),lb=this.__threadIDMap.getServerIDFromClientIDNow(cb),mb=false;if(lb){ib=lb;jb=kb.type=='user'?'user_ids':'thread_fbids';}else{ib=kb.value;switch(kb.type){case 'user':jb='user_ids';mb=true;break;case 'thread':jb='thread_fbids';break;}}var nb={messages:{},threads:{},client:hb};if(jb){nb.messages[jb]={};nb.messages[jb][ib]={offset:db,timestamp:fb,limit:eb};if(mb)nb.threads[jb]=[ib];this.__sendRequest('/ajax/mercury/thread_info.php',nb,gb);}else this.__threadIDMap.getServerIDFromClientID(cb,(function(ob){nb.messages.thread_fbids={};nb.messages.thread_fbids[ob]={offset:db,timestamp:fb,limit:eb};this.__sendRequest('/ajax/mercury/thread_info.php',nb,gb);}).bind(this));},handleThreadInfoError:function(cb){var db=cb.getRequest().getData(),eb=[];if(db.messages){for(var fb in db.messages.thread_fbids)eb.push(this._createServerErrorLogMessage(this.__threadIDMap.getClientIDFromServerIDNow(fb)));for(var gb in db.messages.user_ids)eb.push(this._createServerErrorLogMessage('user:'+gb));for(var hb in db.messages.group_ids)eb.push(this._createServerErrorLogMessage('group:'+hb));}if(eb.length)this._dispatcher.handleUpdate({actions:eb,from_client:true,payload_source:y.CLIENT_CHANNEL_MESSAGE});if(db.threads&&(db.threads.user_ids||db.threads.group_ids||db.threads.thread_ids)){var ib=5,jb=true;if(!db.retry_count){db.retry_count=0;if(db.messages)delete db.messages;}else if(db.retry_count>=ib){jb=false;(db.threads.thread_ids||[]).forEach((function(lb){if(lb in this._fetchingThreads)delete this._fetchingThreads[lb];}).bind(this));}if(jb){var kb=Math.pow(2,db.retry_count)*1000;oa((function(){pa.log('retry_thread','{}');this.__sendRequest('/ajax/mercury/thread_info.php',db);}).bind(this),kb);db.retry_count++;}}},markFolderAsRead:function(cb){this.__sendRequest('/ajax/mercury/mark_folder_as_read.php',{folder:cb});var db=[{action_type:u.MARK_ALL_READ,action_id:null,folder:cb}];this._dispatcher.handleUpdate({global_actions:db,from_client:true,payload_source:y.CLIENT_CHANGE_READ_STATUS});},changeThreadReadStatus:function(cb,db,eb,fb,gb,hb){q.isThreadID(cb);this.__threadIDMap.getServerIDFromClientID(cb,(function(ib){var jb,kb={ids:(jb={},jb[ib]=db,jb),source:eb,watermarkTimestamp:fb,titanOriginatedThreadId:gb,shouldSendReadReceipt:hb};this.__sendRequest('/ajax/mercury/change_read_status.php',kb);}).bind(this));},changeThreadArchivedStatus:function(cb,db,eb){q.isThreadID(cb);this.__threadIDMap.getServerIDFromClientID(cb,(function(fb){var gb={ids:{},source:eb};gb.ids[fb]=db;this.__sendRequest('/ajax/mercury/change_archived_status.php',gb);}).bind(this));},changeThreadFolder:function(cb,db){q.isThreadID(cb);this.__threadIDMap.getServerIDFromClientID(cb,(function(eb){var fb={};fb[db]=[eb];this.__sendRequest('/ajax/mercury/move_thread.php',fb);}).bind(this));},changeMutingOnThread:function(cb,db){q.isThreadID(cb);this.__threadIDMap.getServerIDFromClientID(cb,(function(eb){this.__sendRequest('/ajax/mercury/change_mute_thread.php',{thread_fbid:eb,mute_settings:db,payload_source:qa});}).bind(this));},markThreadSpam:function(cb,db){q.isThreadID(cb);this.__threadIDMap.getServerIDFromClientID(cb,(function(eb){this.__sendRequest('/ajax/mercury/mark_spam.php',{id:eb,source:db});}).bind(this));},unmarkThreadSpam:function(cb,db){q.isThreadID(cb);this.__threadIDMap.getServerIDFromClientID(cb,(function(eb){this.__sendRequest('/ajax/mercury/unmark_spam.php',{id:eb,source:db});}).bind(this));},deleteThread:function(cb,db){q.isThreadID(cb);this.__threadIDMap.getServerIDFromClientID(cb,(function(eb){var fb={ids:[eb],source:db};this.__sendRequest('/ajax/mercury/delete_thread.php',fb);}).bind(this));},unpinThread:function(cb){q.isThreadID(cb);this.__threadIDMap.getServerIDFromClientID(cb,(function(db){this.__sendRequest('/mercury/unpin_thread/',{id:db});}).bind(this));},deleteMessages:function(cb,db){ga.getServerIDs(db||[],(function(eb){this.__sendRequest('/ajax/mercury/delete_messages.php',{message_ids:eb});}).bind(this));},sendDeliveryReceipts:function(cb,db){ga.getServerIDs(cb||[],(function(eb){this.__sendRequest('/ajax/mercury/delivery_receipts.php',{message_ids:eb,thread_ids:db});}).bind(this));},sendNewMessage:function(cb,db){db=db||qa;if(!cb.offline_threading_id)j.bumpEntityKey('chat.web','missing_otid_on_send');if(cb.client_state&&cb.client_state!==x.SEND_TO_SERVER)return;var eb=v.tokenize(cb.thread_id),fb=eb.type,gb=babelHelpers._extends({},cb);gb.thread_id=null;if(fb=='user'){gb.other_user_fbid=eb.value;this._sendNewMessageToServer(gb,db);}else if(fb=='thread'){gb.thread_fbid=eb.value;this._sendNewMessageToServer(gb,db);}else if(fb=='root'&&eb.value==gb.offline_threading_id){gb.client_thread_id=cb.thread_id;this._sendNewMessageToServer(gb,db);}else{!v.isLocalThread(cb.thread_id)?na(0):undefined;this.__threadIDMap.getServerIDFromClientID(cb.thread_id,(function(hb){gb.thread_fbid=hb;this._sendNewMessageToServer(gb,db);}).bind(this));}},_sendNewMessageToServer:function(cb,db){h.inform(k.ATTEMPT_RECONNECT);this._sentMessagesTimestamp[cb.message_id]=Date.now();ca.getForFBID(this._fbid).enqueue(cb.other_user_fbid||cb.thread_fbid||cb.client_thread_id,this._sendMessageQueueOptions,db,cb);},markSeen:function(){var cb=this._lastActionTimestamp;this.__sendRequest('/ajax/mercury/mark_seen.php',{seen_timestamp:cb});},_handleSendMessageErrorCommon:function(cb,db,eb,fb){pa.debug('handle_send_message_error_common',JSON.stringify({reliability_error_status:eb,request_error_status:db}));var gb=cb.getData(),hb=gb.message_batch,ib=hb.map(function(kb){var lb={action_type:o.SEND_MESSAGE,other_user_fbid:kb.other_user_fbid,thread_fbid:kb.thread_fbid,client_message_id:kb.message_id,message_id:kb.message_id,client_thread_id:kb.client_thread_id,status:db,error_data:fb};return lb;});ib.forEach(function(kb){if(kb.action_type===o.SEND_MESSAGE&&kb.status===n.ERROR)z.log(kb);},this);var jb={actions:ib,payload_source:y.CLIENT_HANDLE_ERROR};this._payloadPreprocessor.handleUpdate(jb);},handleSendMessageError:function(cb){var db=cb.getPayload(),eb=null,fb=null;if(db&&db.error_payload){eb=n.UNCONFIRMED;fb='send_error';}else{eb=n.ERROR;fb='request_error'+sa(cb);}var gb=cb.error;if(gb===1404102)i.verboseErrorHandler(cb);var hb=/<.*>/.test(cb.getErrorDescription())?cb.getErrorSummary():cb.getErrorDescription();this._handleSendMessageErrorCommon(cb.getRequest(),eb,fb,{type:t.SERVER,code:cb.getError(),description:hb,is_transient:cb.isTransient()});},handleSendMessageTransportError:function(cb){this._handleSendMessageErrorCommon(cb.getRequest(),n.ERROR,'transport_error'+sa(cb),{type:t.TRANSPORT,code:cb.getError(),is_transient:true});},handleSendMessageTimeout:function(cb){this._handleSendMessageErrorCommon(cb,n.ERROR,'transport_timeout',{type:t.TIMEOUT,is_transient:true});},getLastActionTimestamp:function(){return this._lastActionTimestamp;},updateLastActionTimestamp:function(cb){if(cb)this._lastActionTimestamp=Math.max(this._lastActionTimestamp,cb);},markThreadFetched:function(cb){delete this._fetchingThreads[cb];},_createServerErrorLogMessage:function(cb){return {action_type:o.LOG_MESSAGE,thread_id:cb,message_id:cb,timestamp:Date.now(),timestamp_absolute:'',timestamp_relative:'',is_unread:false,source:ea.UNKNOWN,log_message_type:w.SERVER_ERROR,log_message_data:{}};},_getForAsyncRequest:function(cb){var db=cb.getData(),eb=db.request_user_id?db.request_user_id:l.getID();return bb.getForFBID(eb);},__handleUpdate:function(cb,db){this._getForAsyncRequest(db)._payloadPreprocessor.handleUpdate(cb);},_handleThreadInfoError:function(cb){var db=this._getForAsyncRequest(cb.getRequest());db.handleThreadInfoError(cb);},_handleSendMessageError:function(cb){var db=this._getForAsyncRequest(cb.getRequest());db.handleSendMessageError(cb);},_handleSendMessageTransportError:function(cb){var db=this._getForAsyncRequest(cb.getRequest());db.handleSendMessageTransportError(cb);},_handleSendMessageTimeout:function(cb){var db=this._getForAsyncRequest(cb);db.handleSendMessageTimeout(cb);},_registerEndpoints:function(){var cb=null;if(ba.msgrRegion)cb={name:'X-MSGR-Region',value:ba.msgrRegion};var db={'/ajax/mercury/thread_sync.php':{request_user_id:this._fbid,mode:ja.IDEMPOTENT,customHeader:cb,handler:(function(eb,fb){return this.__handleUpdate(eb,fb);}).bind(this),connection_retries:3},'/ajax/mercury/thread_info.php':{request_user_id:this._fbid,mode:ja.BATCH_DEFERRED_MULTI,customHeader:cb,batch_function:ta,handler:(function(eb,fb){return this.__handleUpdate(eb,fb);}).bind(this),error_handler:(function(eb){return this._handleThreadInfoError(eb);}).bind(this)},'/ajax/mercury/mark_folder_as_read.php':{request_user_id:this._fbid,mode:ja.IMMEDIATE,customHeader:cb,handler:(function(eb,fb){return this.__handleUpdate(eb,fb);}).bind(this)},'/ajax/mercury/change_read_status.php':{request_user_id:this._fbid,mode:ja.IMMEDIATE,customHeader:cb,handler:(function(eb,fb){return this.__handleUpdate(eb,fb);}).bind(this)},'/ajax/mercury/mark_seen.php':{request_user_id:this._fbid,mode:ja.BATCH_SUCCESSIVE,customHeader:cb,batch_function:wa,handler:(function(eb,fb){return this.__handleUpdate(eb,fb);}).bind(this)},'/ajax/mercury/threadlist_info.php':{request_user_id:this._fbid,mode:ja.BATCH_SUCCESSIVE_UNIQUE,customHeader:cb,batch_function:va,handler:(function(eb,fb){return this.__handleUpdate(eb,fb);}).bind(this)},'/ajax/mercury/mark_spam.php':{request_user_id:this._fbid,mode:ja.IMMEDIATE,customHeader:cb,handler:(function(eb,fb){return this.__handleUpdate(eb,fb);}).bind(this)},'/ajax/mercury/unmark_spam.php':{request_user_id:this._fbid,mode:ja.IMMEDIATE,customHeader:cb,handler:(function(eb,fb){return this.__handleUpdate(eb,fb);}).bind(this)},'/ajax/mercury/unread_threads.php':{request_user_id:this._fbid,mode:ja.BATCH_SUCCESSIVE_UNIQUE,customHeader:cb,batch_function:ua,handler:(function(eb,fb){return this.__handleUpdate(eb,fb);}).bind(this)},'/ajax/chat/settings.php':{request_user_id:this._fbid,mode:ja.IMMEDIATE,customHeader:cb},'/ajax/mercury/change_archived_status.php':{request_user_id:this._fbid,mode:ja.BATCH_SUCCESSIVE,customHeader:cb,batch_function:ya,handler:(function(eb,fb){return this.__handleUpdate(eb,fb);}).bind(this)},'/ajax/mercury/delete_thread.php':{request_user_id:this._fbid,mode:ja.BATCH_SUCCESSIVE,customHeader:cb,batch_function:ab,handler:(function(eb,fb){return this.__handleUpdate(eb,fb);}).bind(this)},'/ajax/mercury/delete_messages.php':{request_user_id:this._fbid,mode:ja.IMMEDIATE,customHeader:cb,handler:(function(eb,fb){return this.__handleUpdate(eb,fb);}).bind(this)},'/ajax/mercury/delivery_receipts.php':{request_user_id:this._fbid,mode:ja.IMMEDIATE,customHeader:cb,handler:(function(eb,fb){return this.__handleUpdate(eb,fb);}).bind(this)},'/ajax/mercury/move_thread.php':{request_user_id:this._fbid,mode:ja.BATCH_SUCCESSIVE,customHeader:cb,batch_function:za,handler:(function(eb,fb){return this.__handleUpdate(eb,fb);}).bind(this)},'/ajax/mercury/change_mute_thread.php':{request_user_id:this._fbid,mode:ja.IMMEDIATE,customHeader:cb,handler:(function(eb,fb){return this.__handleUpdate(eb,fb);}).bind(this)},'/mercury/pinned_threads/':{request_user_id:this._fbid,mode:ja.BATCH_SUCCESSIVE_UNIQUE,customHeader:cb,handler:(function(eb,fb){return this.__handleUpdate(eb,fb);}).bind(this)},'/mercury/unpin_thread/':{request_user_id:this._fbid,mode:ja.IMMEDIATE,customHeader:cb,handler:(function(eb,fb){return this.__handleUpdate(eb,fb);}).bind(this)}};ja.registerEndpoints(db);},__sendRequest:function(cb,db,eb){ja.trySend(cb,db,eb,this._fbid);}});Object.assign(bb,da);f.exports=bb;},null);
__d('MercuryThreadIDMap',['KeyedCallbackManager','MercuryAssert','MercuryIDs','MercurySingletonProvider'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();function l(n){this.$MercuryThreadIDMap1=n;this.$MercuryThreadIDMap2=new h();this.$MercuryThreadIDMap3=new h();}l.getForFBID=function(n){return m.getForFBID(n);};l.get=function(){return m.get();};l.prototype.setServerIDToClientID=function(n,o){var p=this.getClientIDFromServerIDNow(n);if(p){p!==o;return;}this.forceSetServerIDToClientID(n,o);};l.prototype.forceSetServerIDToClientID=function(n,o){this.$MercuryThreadIDMap2.setResource(n,o);this.$MercuryThreadIDMap3.setResource(o,n);};l.prototype.setDeprecatedServerIDToClientID=function(n,o){if(n)this.$MercuryThreadIDMap2.setResource(n,o);};l.prototype.getClientIDFromServerIDNow=function(n){return this.$MercuryThreadIDMap2.getResource(n);};l.prototype.getClientIDFromServerID=function(n,o){this.$MercuryThreadIDMap2.executeOrEnqueue(n,o);e(['MercuryServerRequests'],(function(p){p.getForFBID(this.$MercuryThreadIDMap1).ensureThreadIsFetched(n);}).bind(this));};l.prototype.getServerIDFromClientIDNow=function(n){return this.$MercuryThreadIDMap3.getResource(n);};l.prototype.getServerIDFromClientID=function(n,o){i.isThreadID(n);var p=this.$MercuryThreadIDMap3.executeOrEnqueue(n,o);e(['MercuryServerRequests'],(function(q){var r=this.$MercuryThreadIDMap3.getUnavailableResources(p),s=j.tokenize(n);if(r.length&&s.type!='root')q.getForFBID(this.$MercuryThreadIDMap1).fetchThreadData(r);}).bind(this));};l.prototype.hasClientIDForServerID=function(n){return !!this.getClientIDFromServerIDNow(n);};l.prototype.convertThreadIDIfAvailable=function(n){var o=this.getClientIDFromServerIDNow(n);return o||n;};l.prototype.canLinkExternally=function(n){i.isThreadID(n);var o=j.tokenize(n);return o.type=='user'||!!this.getServerIDFromClientIDNow(n);};var m=new k(l);f.exports=l;},null);
__d('MercuryDisplayTimeFilterMessageRenderer',['fbt'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i={renderFilteredContent:function(j){if(j.is_filtered_content_bh)return h._("This message was removed because it contains blocked or harmful links.");if(j.is_filtered_content_account)return h._("This message has been temporarily removed because the sender's account requires verification.");if(j.is_filtered_content_quasar)return h._("This message was removed because it contains blocked or harmful content.");if(j.is_filtered_content_invalid_app)return h._("This message was removed because the app it's being sent from is blocked from sending messages.");return h._("This message has been temporarily removed because the sender's account requires verification, or it was identified as abusive.");}};f.exports=i;},null);
__d('MercuryThreadInfo',['CurrentUser','MercuryIDs'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j={canReply:function(l){return !!(l.is_subscribed&&(l.can_reply===undefined||l.can_reply)&&!l.has_email_participant&&!l.read_only&&(l.recipients_loadable||l.recipients_loadable===undefined));},getMuteSetting:function(l){return (l.mute_settings&&l.mute_settings[k(h.getID())]);},isEmptyLocalThread:function(l){return (i.tokenize(l.thread_id).type==='root'&&!l.timestamp);},isMuted:function(l){return j.getMuteSetting(l)!==undefined;},isNewEmptyLocalThread:function(l){return !!(j.isEmptyLocalThread(l)&&l.participants&&l.participants.length===0);},showComposer:function(l){return !!(l.is_subscribed&&(l.composer_enabled===undefined||l.composer_enabled)&&!l.has_email_participant&&!l.read_only&&(l.recipients_loadable||l.recipients_loadable===undefined));}};function k(l){return l+'@facebook.com';}f.exports=j;},null);
__d('MercuryThreads',['EventEmitter','MercuryDisplayTimeFilterMessageRenderer','ImmutableObject','KeyedCallbackManager','LogHistory','Map','MercuryAPIArgsSource','MercuryActionType','MercuryAssert','MercuryAttachment','MercuryConfig','MercuryDispatcher','MercuryFolders','MercuryGiftSnippetRenderer','MercuryGlobalActionType','MercuryIDs','MercuryLogMessageType','MercuryLoggingHelper','MercuryParticipants','MercuryPayloadSource','MercuryServerRequests','MercurySingletonProvider','MercuryThreadInfo','MercuryThreadInformer','MessagingGenericAdminTextType','MessagingGiftWrapChecker','MessagingTag','Set','emptyFunction','ifRequired','requireWeak','setImmediate'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma){'use strict';if(c.__markCompiled)c.__markCompiled();var na=new h(),oa=l.getInstance('mercury_threads');function pa(ra){this.$MercuryThreads1=ra;this.$MercuryThreads2=ba.getForFBID(this.$MercuryThreads1);this.$MercuryThreads3=ea.getForFBID(this.$MercuryThreads1);this.$MercuryThreads4=w.getParticipantIDFromUserID(this.$MercuryThreads1);this.$MercuryThreads5=s.getForFBID(this.$MercuryThreads1);this.$MercuryThreads6=false;this.$MercuryThreads7=new k();this.$MercuryThreads8=new ia();this.$MercuryThreads9=false;this.$MercuryThreads10=new ia();this.$MercuryThreads11=new ia();this.$MercuryThreads12();}pa.getForFBID=function(ra){return qa.getForFBID(ra);};pa.get=function(){return qa.get();};pa.prototype.getThreadMetaNow=function(ra){p.isThreadID(ra);return this.$MercuryThreads7.getResource(ra);};pa.prototype.getOrFetch=function(ra){var sa=this.getThreadMetaNow(ra);if(!sa&&!this.$MercuryThreads11.has(ra))this.$MercuryThreads10.add(ra);if(this.$MercuryThreads10.size>0&&!this.$MercuryThreads9)this.$MercuryThreads13();return sa;};pa.prototype.getAllLoadedClientThreadIDs=function(){return Object.keys(this.$MercuryThreads7.getAllResources());};pa.prototype.$MercuryThreads13=function(){if(this.$MercuryThreads9)return;this.$MercuryThreads9=true;ma((function(){this.$MercuryThreads9=false;this.$MercuryThreads10.forEach((function(ra){return this.$MercuryThreads11.add(ra);}).bind(this));this.getMultiThreadMeta(Array.from(this.$MercuryThreads10),(function(ra){for(var sa in ra)ra.hasOwnProperty(sa)&&this.$MercuryThreads11['delete'](sa);}).bind(this));this.$MercuryThreads10.clear();}).bind(this));};pa.prototype.getThreadMeta=function(ra,sa,ta){return this.getMultiThreadMeta([ra],function(ua){return sa(ua[ra]);},ta);};pa.prototype.getMultiThreadMeta=function(ra,sa,ta){p.allThreadID(ra);var ua=this.$MercuryThreads7.executeOrEnqueue(ra,sa),va=this.$MercuryThreads7.getUnavailableResources(ua);if(va.length){var wa=[];for(var xa=0;xa<va.length;xa++){var ya=va[xa],za=w.tokenize(ya),ab=za.type,bb=za.value;if(ab=='user'){var cb=w.getParticipantIDFromUserID(bb);this.createNewLocalThread(ya,cb===this.$MercuryThreads4?[this.$MercuryThreads4]:[this.$MercuryThreads4,cb]);}else wa.push(ya);}if(wa.length)this.$MercuryThreads2.fetchThreadData(wa,ta);}return ua;};pa.addListener=function(ra,sa){return na.addListener(ra,sa);};pa.prototype.unsubscribe=function(ra){this.$MercuryThreads7.unsubscribe(ra);};pa.prototype.getCanonicalThreadToParticipant=function(ra,sa,ta,ua){var va=w.getThreadIDFromParticipantID(ra),wa=this.$MercuryThreads7.getResource(va);if(typeof wa=='undefined'){wa=this.createNewLocalThread(va,this.$MercuryThreads4===ra?[this.$MercuryThreads4]:[this.$MercuryThreads4,ra],sa);!ua&&this.$MercuryThreads2.fetchThreadData([va],ta);}return wa;};pa.prototype.createNewLocalThread=function(ra,sa,ta){var ua=this.$MercuryThreads7.getResource(ra);if(!ua){var va=w.tokenize(ra),wa=va.type,xa=va.value;ua=new j({thread_id:ra,participants:Array.from(sa),name:'',snippet:'',snippet_has_attachment:false,snippet_sender:null,unread_count:ta?ta:0,message_count:0,image_src:null,timestamp_absolute:null,timestamp_relative:null,timestamp:null,other_user_fbid:wa==='user'?xa:null,is_canonical_user:wa=='user',is_canonical:this.$MercuryThreads14(sa),is_subscribed:true,folder:ha.INBOX,is_archived:false});this.$MercuryThreads7.setResource(ra,ua);}return ua;};pa.prototype.isEmptyLocalThread=function(ra){var sa=this.$MercuryThreads7.getResource(ra);if(!sa)return false;return da.isEmptyLocalThread(sa);};pa.prototype.isNewEmptyLocalThread=function(ra){var sa=this.$MercuryThreads7.getResource(ra);if(!sa)return false;return da.isNewEmptyLocalThread(sa);};pa.prototype.$MercuryThreads15=function(ra,sa){if(!ra||!ra.length)return;var ta=new m(),ua=new m(),va=new m(),wa=[];for(var xa=0;xa<ra.length;xa++){var ya=ra[xa];if(ya.is_forward)continue;var za=ya.action_type;if(za==o.LOG_MESSAGE&&ya.log_message_type==x.SERVER_ERROR)continue;var ab=!!(ya.sync_id||ya.action_id||ya.is_from_iris),bb=ya.thread_id;p.isThreadID(bb);var cb=this.$MercuryThreads7.getResource(bb);if(!cb&&!ab&&za==o.USER_GENERATED_MESSAGE){cb=this.$MercuryThreads16(ya);this.$MercuryThreads7.setResource(bb,cb);}if(!cb)continue;if(za==o.LOG_MESSAGE||za==o.USER_GENERATED_MESSAGE)ab=!sa;if(cb.server_timestamp&&ya.timestamp<=cb.server_timestamp&&ab)continue;if(!va.has(bb))va.set(bb,babelHelpers._extends({},cb));this.$MercuryThreads17(va.get(bb),ya,sa);if(za==o.USER_GENERATED_MESSAGE)ta.set(bb,ya);if(za==o.USER_GENERATED_MESSAGE||za==o.LOG_MESSAGE||za==o.SEND_MESSAGE){if(za==o.SEND_MESSAGE&&r.WWWDontUpdateTimestampOnSendGK)continue;if(ya&&ya.timestamp&&(!ua.has(bb)||ya.timestamp>ua.get(bb).timestamp))ua.set(bb,ya);}}va.forEach((function(db,eb){var fb=ua.get(eb),gb=ta.get(eb);if(gb){this.$MercuryThreads18(db,gb);}else if(fb&&fb.log_message_body){var hb=babelHelpers._extends({},fb,{body:fb.log_message_body});this.$MercuryThreads18(db,hb);}var ib=db.timestamp;if(fb){if(fb.timestamp>ib)Object.assign(db,{timestamp_absolute:fb.timestamp_absolute,timestamp_relative:fb.timestamp_relative,timestamp:fb.timestamp});var jb=db.server_timestamp;if(!sa&&fb.timestamp>jb)db.server_timestamp=fb.timestamp;}var kb=new j(db);this.$MercuryThreads7.setResource(eb,kb);wa.push(y.obfuscateThread(kb));}).bind(this),this);wa.length&&this.$MercuryThreads6&&oa.debug('threads_updated',JSON.stringify({threads:wa}));};pa.prototype.$MercuryThreads17=function(ra,sa,ta){var ua=sa.action_type;if(ua==o.USER_GENERATED_MESSAGE||ua==o.LOG_MESSAGE){sa.is_unread&&ra.unread_count++;ra.message_count++;ra.is_archived=false;}switch(ua){case o.DELETE_THREAD:ra.message_count=0;this.$MercuryThreads19(sa.thread_id);break;case o.USER_GENERATED_MESSAGE:if(ra.unread_count===0&&sa.author===this.$MercuryThreads4&&sa.timestamp>=ra.last_read_timestamp)ra.last_read_timestamp=sa.timestamp;if(sa.offline_threading_id!==sa.message_id){ra.last_message_id=sa.message_id;ra.last_message_timestamp=sa.timestamp;}this.$MercuryThreads20(ra,sa.author);break;case o.SEND_MESSAGE:var va=sa.log_message_type;if(va==x.THREAD_IMAGE){ra.image_src=sa.log_message_data.image?sa.log_message_data.image.preview_url:null;this.$MercuryThreads21(sa.thread_id);}if(va!==x.SUBSCRIBE&&va!==x.UNSUBSCRIBE)ra.snippet_attachments=sa.attachments;break;case o.LOG_MESSAGE:var va=sa.log_message_type;if(va==x.SUBSCRIBE){this.$MercuryThreads22(ra,sa.log_message_data.added_participants);this.$MercuryThreads21(sa.thread_id);}else if(va==x.UNSUBSCRIBE){this.$MercuryThreads23(ra,sa.log_message_data.removed_participants);this.$MercuryThreads21(sa.thread_id);}else if(va==x.THREAD_IMAGE){if(!ta)ra.image_src=sa.log_message_data.image?sa.log_message_data.image.preview_url:null;}else if(va==x.THREAD_NAME){if(ra.name!==sa.log_message_data.name)this.$MercuryThreads21(sa.thread_id);ra.name=sa.log_message_data.name;}else if(va===x.GENERIC_ADMIN_TEXT)this.$MercuryThreads24(ra,sa);break;case o.CHANGE_READ_STATUS:var wa=this.$MercuryThreads25(ra,sa,sa.mark_as_read);if(wa)ra.last_read_timestamp=ra.last_message_timestamp;var xa=!ra.read_only&&ra.folder===ha.INBOX;if(wa&&ta)this.$MercuryThreads2.changeThreadReadStatus(ra.thread_id,sa.mark_as_read,sa.source,ra.last_read_timestamp,ra.titan_originated_thread_id,xa);break;case o.CHANGE_ARCHIVED_STATUS:if(ra.is_archived!=sa.archived){ra.is_archived=sa.archived;this.$MercuryThreads21(sa.thread_id);}break;case o.CHANGE_FOLDER:if(ra.folder!=sa.new_folder){ra.folder=sa.new_folder;this.$MercuryThreads21(sa.thread_id);}break;case o.DELETE_MESSAGES:if(ta){ra.snippet='...';ra.snippet_has_attachment=false;ra.snippet_attachments=null;ra.snippet_sender=null;this.$MercuryThreads21(sa.thread_id);}else if(sa.message_ids){ra.message_count-=sa.message_ids.length;ka('MercuryMessages',(function(ab){ab=ab.getForFBID(this.$MercuryThreads1);for(var bb=sa.message_ids,cb=Array.isArray(bb),db=0,bb=cb?bb:bb[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var eb;if(cb){if(db>=bb.length)break;eb=bb[db++];}else{db=bb.next();if(db.done)break;eb=db.value;}var fb=eb,gb=ab.getMessagesFromIDs([fb]),hb=gb[0];if(hb&&hb.timestamp>ra.last_read_timestamp)ra.unread_count=Math.max(0,ra.unread_count-1);}this.$MercuryThreads21(sa.thread_id);}).bind(this),ja);}break;case o.UPDATE_SNIPPET:ka('MercuryMessages',(function(ab){ab=ab.getForFBID(this.$MercuryThreads1);var bb=false;for(var cb=sa.deleted_ids,db=Array.isArray(cb),eb=0,cb=db?cb:cb[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var fb;if(db){if(eb>=cb.length)break;fb=cb[eb++];}else{eb=cb.next();if(eb.done)break;fb=eb.value;}var gb=fb;if(gb==ra.last_message_id){bb=true;break;}}if(!bb)return;var hb=0,ib=1,jb=ab.getThreadMessagesRangeNow(sa.thread_id,hb,ib),kb=jb[0];if(kb){ra.snippet=kb.body;ra.snippet_has_attachment=kb.has_attachment;ra.snippet_attachments=kb.attachments;ra.snippet_sender=kb.author;ra.last_message_id=ab.getServerMessageID(kb.message_id);}else{ra.snippet='...';ra.snippet_has_attachment=false;ra.snippet_attachments=null;ra.snippet_sender=null;ab.getThreadMessagesRange(sa.thread_id,hb,ib,(function(lb){if(lb.length)this.$MercuryThreads5.handleUpdate({from_client:true,actions:[{thread_id:sa.thread_id,action_type:o.UPDATE_SNIPPET,deleted_ids:sa.deleted_ids}]});}).bind(this));}this.$MercuryThreads21(sa.thread_id);}).bind(this),ja);break;case o.UPDATE_BLOCKER_STATUS:ra.can_reply=!!(!sa.message_blocked&&(sa.is_blocked_by_recipient===undefined||!sa.is_blocked_by_recipient)&&ra.is_subscribed&&!ra.has_email_participant&&!ra.read_only&&(ra.recipients_loadable||ra.recipients_loadable===undefined));this.$MercuryThreads21(sa.thread_id);break;case o.UPDATE_BLOCKEE_STATUS:ra.can_reply=!!(!sa.got_blocked&&ra.is_subscribed&&!ra.has_email_participant&&!ra.read_only&&(ra.recipients_loadable||ra.recipients_loadable===undefined));this.$MercuryThreads21(sa.thread_id);break;case o.CHANGE_MUTE_SETTINGS:if(sa.mute_settings!==undefined){var ya=this.$MercuryThreads1+'@facebook.com';if(ra.mute_settings){if(sa.mute_settings){var za={};za[ya]=sa.mute_settings;ra.mute_settings=babelHelpers._extends({},ra.mute_settings,za);}else{ra.mute_settings=babelHelpers._extends({},ra.mute_settings);delete ra.mute_settings[ya];}this.$MercuryThreads21(ra.thread_id);}}break;case o.ADD_PARTICIPANTS:this.$MercuryThreads22(ra,sa.participants);this.$MercuryThreads21(ra.thread_id);break;case o.CHANGE_FLAG:this.$MercuryThreads26(ra,sa.mark_as_flag);this.$MercuryThreads21(ra.thread_id);break;case o.MOVE_PENDING_TO_INBOX:this.$MercuryThreads27(ra);this.$MercuryThreads21(ra.thread_id);break;case o.UPDATE_CUSTOM_LIKE:ra.custom_like_icon=sa.custom_like;this.$MercuryThreads21(ra.thread_id);break;}};pa.prototype.$MercuryThreads24=function(ra,sa){if(sa.log_message_data&&sa.log_message_data.untypedData){var ta=sa.log_message_data.untypedData;switch(sa.log_message_data.message_type){case fa.THREAD_EPHEMERAL_SEND_MODE:var ua=parseInt(ta.ttl,10);if(ua!==null&&ra.ephemeral_ttl_mode!==ua){ra.ephemeral_ttl_mode=ua;this.$MercuryThreads21(sa.thread_id);}break;case fa.CHANGE_THREAD_NICKNAME:var va={};for(var wa in ra.custom_nickname)va[wa]=ra.custom_nickname[wa];va[ta.participant_id]=ta.nickname;ra.custom_nickname=va;this.$MercuryThreads21(sa.thread_id);break;case fa.CHANGE_THREAD_ICON:la('MercuryThreadActions',(function(ya){ya.getForFBID(this.$MercuryThreads1).updateCustomLike(sa.thread_id,ta.thread_icon);}).bind(this));break;case fa.CHANGE_THREAD_THEME:var xa=ta.theme_color;if(xa.length>0){ra.custom_color='#'.concat(xa.substring(2));}else ra.custom_color=null;this.$MercuryThreads21(sa.thread_id);break;}}};pa.prototype.$MercuryThreads16=function(ra){var sa=w.tokenize(ra.thread_id),ta=sa.type,ua=sa.value,va=ra.specific_to_list&&this.$MercuryThreads14(ra.specific_to_list);return new j({thread_id:ra.thread_id,participants:ra.specific_to_list,name:null,snippet:ra.body,snippet_has_attachment:false,snippet_attachments:[],snippet_sender:ra.author,unread_count:0,message_count:0,image_src:null,timestamp_absolute:ra.timestamp_absolute,timestamp_relative:ra.timestamp_relative,timestamp:ra.timestamp,other_user_fbid:ta==='user'?ua:null,is_canonical_user:ta==='user',is_canonical:va,is_subscribed:true,folder:ha.INBOX,is_archived:false});};pa.prototype.$MercuryThreads25=function(ra,sa,ta){if(sa.timestamp)this.$MercuryThreads28(ra.thread_id,ta,sa.timestamp);if(!ra||!ra.thread_id)return false;if(!ra.timestamp){this.$MercuryThreads8.add(ra.thread_id);return false;}var ua=!ra.unread_count;if(ta==ua)return false;ra.unread_count=ta?0:1;this.$MercuryThreads21(ra.thread_id);return true;};pa.prototype.$MercuryThreads29=function(ra){var sa=this.$MercuryThreads7.getAllResources();for(var ta in sa)if(sa.hasOwnProperty(ta)){var ua=sa[ta];if(ua.folder==ra){this.$MercuryThreads7.setResource(ta,j.setProperty(ua,'unread_count',0));this.$MercuryThreads21(ta);}}};pa.prototype.$MercuryThreads22=function(ra,sa){var ta=new ia(ra.participants);ra.participants=Array.from(ra.participants);sa.forEach((function(ua){if(!ta.has(ua)){ra.participants.push(ua);if(ua===this.$MercuryThreads4){ra.is_subscribed=true;ra.can_reply=true;ra.composer_enabled=true;this.$MercuryThreads2.fetchMissedMessages(t.getSupportedFolders(),n.MERCURYSYNC,ra.last_message_timestamp);}}}).bind(this));};pa.prototype.$MercuryThreads23=function(ra,sa){var ta=new ia(sa);ra.participants=ra.participants.filter(function(ua){return !ta.has(ua);});if(ta.has(this.$MercuryThreads4))ra.is_subscribed=false;this.$MercuryThreads2.fetchThreadData([ra.thread_id]);};pa.prototype.$MercuryThreads20=function(ra,sa){var ta=ra.participants.indexOf(sa);if(ta>0)ra.participants=[sa].concat(ra.participants.slice(0,ta),ra.participants.slice(ta+1));};pa.prototype.$MercuryThreads18=function(ra,sa){var ta=sa.body,ua=sa.subject,va='';if(ua){ua=ua.toLowerCase();if(ta.slice(0,ua.length).toLowerCase()==ua){va=ta;}else if(ta){va=ua+' \u00B7 '+ta;}else va=ua;}else va=ta;if(sa.is_filtered_content)va=i.renderFilteredContent(sa);if(ga.shouldRenderWithGiftWrap(sa)){var wa=sa.author,xa=wa==this.$MercuryThreads4,ya=null;if(!xa){ya=ra.custom_nickname&&ra.custom_nickname[w.getUserIDFromParticipantID(wa)];if(!ya){var za=z.getNow(wa);if(za!=null)ya=za.short_name;}}va=u.renderText(xa,ya);}ra.snippet=va;ra.snippet_has_attachment=sa.has_attachment;if(sa.raw_attachments&&sa.raw_attachments.length>0){var ab=q.convertRaw(sa.raw_attachments);ra.snippet_attachments=ab;}else ra.snippet_attachments=sa.attachments;if(!sa.log_message_type)ra.snippet_sender=sa.author;};pa.prototype.$MercuryThreads26=function(ra,sa){ra.page_thread_info=babelHelpers._extends({},ra.page_thread_info,{flagged:sa});};pa.prototype.$MercuryThreads27=function(ra){if(ra.folder!==ha.PENDING)return;ra.folder=ha.INBOX;};pa.prototype.$MercuryThreads14=function(ra){return ra.filter((function(sa){return sa!=this.$MercuryThreads4;}).bind(this)).length<=1;};pa.prototype.$MercuryThreads12=function(){this.$MercuryThreads5.subscribe('invalidate-thread-state',(function(ra,sa){return this.$MercuryThreads30(sa);}).bind(this));this.$MercuryThreads5.subscribe('invalidate-global-state',(function(ra,sa){return this.$MercuryThreads31();}).bind(this));this.$MercuryThreads5.subscribe('update-threads',(function(ra,sa){var ta=(sa.actions||[]).filter(function(ua){return ua.thread_id;});if(sa.threads&&sa.payload_source==aa.SERVER_FETCH_THREAD_INFO)sa.threads.forEach((function(ua){var va=ua.thread_id;if(this.$MercuryThreads8.has(va)){this.$MercuryThreads8['delete'](va);if(ua.unread_count)this.$MercuryThreads2.changeThreadReadStatus(ua.thread_id,true);}}).bind(this));this.$MercuryThreads32(sa.threads);this.$MercuryThreads15(ta,sa.from_client);sa.threads&&sa.threads.forEach((function(ua){this.$MercuryThreads21(ua.thread_id);}).bind(this));if(sa.global_actions)sa.global_actions.forEach((function(ua){if(ua.action_type==v.MARK_ALL_READ)this.$MercuryThreads29(ua.folder);}).bind(this));if(this.$MercuryThreads6){this.$MercuryThreads6=false;na.emit('change');}}).bind(this));};pa.prototype.$MercuryThreads32=function(ra){if(!ra||!ra.length)return;var sa={},ta=[];ra.forEach(function(ua){var va=new j(ua);sa[ua.thread_id]=va;ta.push(y.obfuscateThread(va));});ta.length&&oa.debug('threads_added',JSON.stringify({threads:ta}));this.$MercuryThreads7.addResourcesAndExecute(sa);};pa.prototype.$MercuryThreads21=function(ra){this.$MercuryThreads6=true;this.$MercuryThreads3.updatedThread(ra);};pa.prototype.$MercuryThreads19=function(ra){this.$MercuryThreads6=true;this.$MercuryThreads3.deletedThread(ra);};pa.prototype.$MercuryThreads28=function(ra,sa,ta){this.$MercuryThreads6=true;this.$MercuryThreads3.changedThreadReadState(ra,sa,ta);};pa.prototype.$MercuryThreads30=function(ra){this.$MercuryThreads7.setResource(ra,undefined);};pa.prototype.$MercuryThreads31=function(){this.$MercuryThreads6=false;this.$MercuryThreads7=new k();this.$MercuryThreads8=new ia();this.$MercuryThreads9=false;this.$MercuryThreads10=new ia();this.$MercuryThreads11=new ia();};var qa=new ca(pa);f.exports=pa;},null);
__d('MercuryUnreadState',['MercuryFolders','LogHistory','KeyedCallbackManager','MercuryActionType','MercuryDispatcher','MercuryGlobalActionType','MercurySingletonMixin','MercuryThreadlistConstants','MercuryThreadIDMap','MessagingTag','MercuryServerRequests','MercuryThreadInformer','MercuryThreads','arrayContains','createObjectFrom'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){if(c.__markCompiled)c.__markCompiled();var w=(h.getSupportedFolders()||[]).filter(function(oa){return oa!=q.ACTION_ARCHIVED;}),x='unread_thread_hash',y='unseen_thread_list',z=o.MAX_UNREAD_COUNT,aa=i.getInstance('mercury_unread_state');function ba(oa){this._fbid=oa;this._serverRequests=r.getForFBID(this._fbid);this._threadIDMap=p.getForFBID(this._fbid);this._threadInformer=s.getForFBID(this._fbid);this._threads=t.getForFBID(this._fbid);this._dispatcher=l.getForFBID(this._fbid);this._allReadTimestamp={};this._threadReadTimestamp={};this._initialUnreadCount={};this._maxCount={};this._unreadResources={};w.forEach((function(pa){this._initialUnreadCount[pa]=0;this._maxCount[pa]=false;this._unreadResources[pa]=new j();}).bind(this));this._dispatcher.subscribe('update-unread',(function(pa,qa){ga(this,qa);var ra=qa.global_actions||[];for(var sa=0;sa<ra.length;sa++){var ta=ra[sa];if(ta.action_type==m.MARK_ALL_READ)ja(this,ta.folder,ta.timestamp);}}).bind(this));this._dispatcher.subscribe('update-thread-ids',(function(pa,qa){la(this,qa);}).bind(this));}Object.assign(ba.prototype,{getUnreadCount:function(oa){if(this.exceedsMaxCount(oa)){aa.error('unguarded_unread_count_fetch','{}');return 0;}return fa(this,oa);},exceedsMaxCount:function(oa){return this._maxCount[oa]||fa(this,oa)>z;},markFolderAsRead:function(oa){if(this._maxCount[oa]||fa(this,oa)>0)this._serverRequests.markFolderAsRead(oa);},getIsThreadUnread:function(oa,pa){var qa=pa||q.INBOX,ra=ea(this,qa);return ra&&ra[oa];}});Object.assign(ba,n);function ca(oa,pa,qa){oa._unreadResources[pa].setResource(x,qa);oa._unreadResources[pa].setResource(y,Object.keys(qa));}function da(oa,pa,qa){var ra=oa._unreadResources[pa].executeOrEnqueue(x,qa),sa=oa._unreadResources[pa].getUnavailableResources(ra);if(sa.length)oa._serverRequests.fetchUnreadThreadIDs(pa);}function ea(oa,pa){return oa._unreadResources[pa].getResource(x);}function fa(oa,pa){var qa=oa._unreadResources[pa].getResource(y);if(qa){return qa.length;}else return oa._initialUnreadCount[pa];}function ga(oa,pa){var qa;(pa.unread_thread_fbids||[]).forEach(function(ra){qa=ra.folder;if(!na(qa))return;var sa=ra.thread_fbids||[];sa=sa.concat(ra.other_user_fbids||[]);var ta=ka(oa,sa);ca(oa,qa,v(ta,true));if(ta.length>z)oa._maxCount[qa]=true;oa._threadInformer.updatedUnreadState();});(pa.message_counts||[]).forEach(function(ra){if(ra.unread_count===undefined)return;qa=ra.folder;if(ra.unread_count>z){oa._maxCount[qa]=true;ca(oa,qa,{});oa._threadInformer.updatedUnreadState();}else{oa._initialUnreadCount[qa]=ra.unread_count;if(oa._initialUnreadCount[qa]===0)ca(oa,qa,{});oa._threadInformer.updatedUnreadState();}});(pa.actions||[]).forEach(function(ra){if(ra.is_forward)return;var sa=k,ta=ra.other_user_fbid?ra.other_user_fbid:ra.thread_fbid,ua=ra.thread_id?ra.thread_id:ta;if(ra.action_type==sa.DELETE_THREAD){w.forEach(function(wa){ia(oa,wa,ua);});}else if(ra.action_type==sa.CHANGE_ARCHIVED_STATUS||ra.action_type==sa.CHANGE_FOLDER){var va=oa._threads.getThreadMetaNow(ra.thread_id);qa=h.getFromMeta(va);if(na(qa)&&va.unread_count>0)ha(oa,qa,ua);w.forEach(function(wa){if(wa!=qa)ia(oa,wa,ua);});}else{qa=ma(oa,ra);if(!na(qa))return;if(ra.action_type==sa.CHANGE_READ_STATUS){if(ra.mark_as_read){ia(oa,qa,ua,ra.timestamp);}else ha(oa,qa,ua,ra.timestamp);}else if(ra.action_type==sa.USER_GENERATED_MESSAGE||ra.action_type==sa.LOG_MESSAGE)if(ra.is_unread)ha(oa,qa,ua,ra.timestamp);}});}function ha(oa,pa,qa,ra){if(oa._maxCount[pa])return;da(oa,pa,function(sa){var ta=oa._allReadTimestamp[pa]||0,ua=oa._threadReadTimestamp[qa]||0,va=ra||Number.POSITIVE_INFINITY;if(va>=ta&&va>=ua&&!sa[qa]){sa[qa]=ra||0;ca(oa,pa,sa);oa._threadInformer.updatedUnreadState();}});}function ia(oa,pa,qa,ra){if(oa._maxCount[pa])return;da(oa,pa,function(sa){if(ra){var ta=oa._threadReadTimestamp[qa];if(!ta||ta<ra)oa._threadReadTimestamp[qa]=ra;}var ua=sa[qa];if(ra&&typeof ua=='number'&&ra<ua)return;if(qa in sa){delete sa[qa];ca(oa,pa,sa);oa._threadInformer.updatedUnreadState();}});}function ja(oa,pa,qa){oa._maxCount[pa]=false;ca(oa,pa,{});oa._allReadTimestamp[pa]=Math.max(oa._allReadTimestamp[pa]||0,qa||0);oa._threadInformer.updatedUnreadState();}function ka(oa,pa){return pa.map(oa._threadIDMap.convertThreadIDIfAvailable,oa._threadIDMap);}function la(oa,pa){w.forEach(function(qa){var ra=ea(oa,qa);if(!ra)return;for(var sa in pa){var ta=pa[sa];if(ra[sa]){ra[ta]=ra[sa];delete ra[sa];}}ca(oa,qa,ra);});}function ma(oa,pa){var qa=pa.thread_id?oa._threads.getThreadMetaNow(pa.thread_id):null;return qa?h.getFromMeta(qa):pa.folder;}function na(oa){return u(w,oa);}f.exports=ba;},null);
__d('MercuryLeftNav',['Arbiter','MessagingTag','NavigationMessage','MercuryThreadInformer','MercuryUnreadState'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=c('MercuryThreadInformer').get(),l=c('MercuryUnreadState').get(),m=false;function n(){var p=l.getUnreadCount(i.INBOX);h.inform(j.NAVIGATION_COUNT_UPDATE,{key:'inbox',hide:true});h.inform(j.NAVIGATION_COUNT_UPDATE,{key:'inbox',count:p});}var o={bootstrap:function(){if(m)return;k.subscribe('unread-updated',n);m=true;}};f.exports=o;},null);