/*!CK:410675144!*//*1455046474,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["fwBHw"]); }

__d("PagesMessagingHomePageletAction",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={CLICK_MESSAGE:"click_message",MARK_ARCHIVE:"mark_archive",MARK_READ:"mark_read",MARK_SPAM:"mark_spam",REPLY_MESSAGE:"reply_message",GO_TO_INBOX:"go_to_inbox"};},null);
__d('PagesMessagingLoadingRow.react',['React','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k,l;k=babelHelpers.inherits(m,h.Component);l=k&&k.prototype;function m(n,o){'use strict';l.constructor.call(this,n,o);}m.prototype.render=function(){'use strict';var n="_5y2c"+(!this.props.useDarkVersion?' '+"_4a7c":'')+(this.props.useDarkVersion?' '+"_4a7d":'');n=j(n,this.props.className);return (h.createElement('div',{className:n}));};f.exports=m;},null);
__d('PagesMessagingRelativeTimestamp.react',['React','LongLiveTimer'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j,k;'use strict';var l=1000;j=babelHelpers.inherits(m,h.Component);k=j&&j.prototype;function m(n,o){k.constructor.call(this,n,o);this.state={relativeTime:this.$PagesMessagingRelativeTimestamp1(n.utcTimestamp,n.shouldShorternTime)};}m.prototype.componentWillReceiveProps=function(n){if(n.utcTimestamp!==this.props.utcTimestamp||n.shouldShorternTime!==this.props.shouldShorternTime)this.setState({relativeTime:this.$PagesMessagingRelativeTimestamp1(n.utcTimestamp,n.shouldShorternTime)});};m.prototype.render=function(){return (h.createElement('div',{className:this.props.className},h.createElement('abbr',{className:'livetimestamp','data-utime':this.props.utcTimestamp/l,'data-shorten':this.props.shouldShorternTime},this.state.relativeTime.text.toLowerCase())));};m.prototype.$PagesMessagingRelativeTimestamp1=function(n,o){return i.renderRelativeTimeToServer(n/l,o);};f.exports=m;},null);
__d('PagesMessageSnippetFetcher',['MercuryFilters','MercuryOrderedThreadlist','MercuryPagesChannelHandler','MercuryParticipants','MercuryThreadInformer','MercuryThreads','MessagingTag','SubscriptionsHandler','XPagesManagerMessagesController','invariant','PagesMessagingConst'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){'use strict';if(c.__markCompiled)c.__markCompiled();var s=r.UNANSWERED_FILTER;t.getUnreadInboxURI=function(u){return p.getURIBuilder().setString('page_token',u).setString('folder',n.INBOX).setString('initialClientFilter',s).getURI();};t.getSpecificThreadInboxURI=function(u,v){return t.getUnreadInboxURI(u);};function t(u,v,w){this.$PagesMessageSnippetFetcher1=u;this.$PagesMessageSnippetFetcher2=v;this.$PagesMessageSnippetFetcher3=w;j.getForFBID(u).turnOn();this.$PagesMessageSnippetFetcher4=i.getForFBID(u);this.$PagesMessageSnippetFetcher5=m.getForFBID(u);this.$PagesMessageSnippetFetcher6=l.getForFBID(u);this.$PagesMessageSnippetFetcher7=new o();this.$PagesMessageSnippetFetcher8();this.$PagesMessageSnippetFetcher9=false;}t.prototype.$PagesMessageSnippetFetcher10=function(u){this.$PagesMessageSnippetFetcher7.addSubscriptions(this.$PagesMessageSnippetFetcher6.subscribe(u,(function(v,w){return this.fetch();}).bind(this)));};t.prototype.$PagesMessageSnippetFetcher8=function(){this.$PagesMessageSnippetFetcher10('threadlist-updated');this.$PagesMessageSnippetFetcher10('threads-updated');this.$PagesMessageSnippetFetcher10('unread-updated');};t.prototype.fetch=function(){if(this.$PagesMessageSnippetFetcher9)return;this.$PagesMessageSnippetFetcher9=true;this.$PagesMessageSnippetFetcher4.getFilteredThreadlist(0,1,n.INBOX,h.UNREAD,(function(u){return this.$PagesMessageSnippetFetcher11(u);}).bind(this));};t.prototype.cleanup=function(){j.getForFBID(this.$PagesMessageSnippetFetcher1).turnOff();this.$PagesMessageSnippetFetcher7.release();};t.prototype.$PagesMessageSnippetFetcher11=function(u){if(!u||u.length===0){this.$PagesMessageSnippetFetcher3();this.$PagesMessageSnippetFetcher9=false;return;}var v=this.$PagesMessageSnippetFetcher5.getThreadMetaNow(u[0]);!v?q(0):undefined;var w='fbid:'+v.other_user_fbid;k.get(w,(function(x){this.$PagesMessageSnippetFetcher9=false;!v?q(0):undefined;this.$PagesMessageSnippetFetcher2({content:v.snippet,senderImageSrc:x.image_src,senderName:x.name,threadID:v.thread_id,timestamp:v.last_message_timestamp,senderID:v.other_user_fbid,senderShortName:x.short_name});}).bind(this));};f.exports=t;},null);
__d('PagesMessagingHomePageletLogger',['BanzaiLogger'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=h.create({retry:true});function j(k){this.$PagesMessagingHomePageletLogger1=k;}j.prototype.$PagesMessagingHomePageletLogger2=function(event,k){var l={is_embedded:this.$PagesMessagingHomePageletLogger1,event_name:event};if(k)l=Object.assign(l,k);i.log('PagesHomepagePageletUsageLoggerConfig',l);};j.prototype.logEvent=function(k){this.$PagesMessagingHomePageletLogger2(k,null);};j.prototype.logEventWithUserMessage=function(k,l){this.$PagesMessagingHomePageletLogger2(k,{user_message:l});};j.prototype.logReplyMessage=function(k,l,m){this.$PagesMessagingHomePageletLogger2(k,{user_message:l,admin_message:m});};f.exports=j;},null);
__d('PagesMessagingInboxOverviewActionMenu.react',['ContextualDialogArrow','ContextualLayerAutoFlip','immutable','PagesMessengerActions','PopoverMenu.react','React','ReactXUIMenu','cx','fbt','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();var r,s;'use strict';var t=n.Item;r=babelHelpers.inherits(u,m.Component);s=r&&r.prototype;function u(v,w){s.constructor.call(this,v,w);this.$PagesMessagingInboxOverviewActionMenu1=j.List([{key:k.MARK_AS_READ,label:p._("Mark as read"),href:'#'},{key:k.MARK_AS_SPAM,label:p._("Mark as spam"),href:'#'},{key:k.ARCHIVE,label:p._("Archive"),href:'#'},{key:k.GO_TO_INBOX,label:p._("Go to Inbox"),href:this.props.inboxUri}]);this.$PagesMessagingInboxOverviewActionMenu2=(function(x,y){this.props.onActionTaken(y.item.getValue());}).bind(this);}u.prototype.render=function(){var v=q(this.props.className,"_5p3k");return (m.createElement(l,{alignh:'right',layerBehaviors:[h,i],menu:this.$PagesMessagingInboxOverviewActionMenu3()},m.createElement('div',{className:v,'aria-label':p._("See more options"),'data-hover':'tooltip'})));};u.prototype.$PagesMessagingInboxOverviewActionMenu4=function(v){return (m.createElement(t,{className:"_539_",value:v.key,key:v.key,href:v.href,target:'_blank'},v.label));};u.prototype.$PagesMessagingInboxOverviewActionMenu3=function(){return (m.createElement(n,{onItemClick:this.$PagesMessagingInboxOverviewActionMenu2},this.$PagesMessagingInboxOverviewActionMenu1.map((function(v){return this.$PagesMessagingInboxOverviewActionMenu4(v);}).bind(this))));};f.exports=u;},null);
__d('PagesMessageSender',['MercuryMessageActions','MercuryMessageObject','MercurySourceType'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();function k(l,m,n,o){this.__senderID=l;this.__threadID=m;this.__messageActions=h.getForFBID(l);this.__messageObject=i.getForFBID(l);this.__creatorInfo=o?o:null;this.__pageID=n;}k.prototype.__willSendMessage=function(l){};k.prototype.getTargetThreadID=function(){return this.__threadID;};k.prototype.sendMessage=function(l){this.__willSendMessage(l);var m=this.__messageObject.constructUserGeneratedMessageObject(l,j.TITAN_WEB,this.__threadID,null,this.__creatorInfo);this.__messageActions.send(m);};f.exports=k;},null);
__d('PagesMessagingInboxOverviewMessageProcessor',['MercuryPageThreadActions','PagesMessagingHomePageletAction','PagesMessagingHomePageletLogger','PagesMessageSender','PagesMessagingActionPlacement'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m,n;'use strict';m=babelHelpers.inherits(o,k);n=m&&m.prototype;function o(p,q,r,s){n.constructor.call(this,q,s.threadID,q,p);this.$PagesMessagingInboxOverviewMessageProcessor1=r;this.$PagesMessagingInboxOverviewMessageProcessor2=s;this.$PagesMessagingInboxOverviewMessageProcessor3=h.getForFBID(q);this.$PagesMessagingInboxOverviewMessageProcessor4=new j(r);}o.prototype.__willSendMessage=function(p){this.$PagesMessagingInboxOverviewMessageProcessor4.logReplyMessage(i.REPLY_MESSAGE,this.$PagesMessagingInboxOverviewMessageProcessor2.content,p);this.markAsRead();};o.prototype.$PagesMessagingInboxOverviewMessageProcessor5=function(p){this.$PagesMessagingInboxOverviewMessageProcessor4.logEventWithUserMessage(p,this.$PagesMessagingInboxOverviewMessageProcessor2.content);};o.prototype.$PagesMessagingInboxOverviewMessageProcessor6=function(p){p.call(this.$PagesMessagingInboxOverviewMessageProcessor3,[this.__threadID],l.HOME_PAGE_PAGELET_INLINE_ACTION);};o.prototype.markAsSpam=function(){this.$PagesMessagingInboxOverviewMessageProcessor5(i.MARK_SPAM);this.$PagesMessagingInboxOverviewMessageProcessor6(this.$PagesMessagingInboxOverviewMessageProcessor3.batchMarkSpam);};o.prototype.markAsRead=function(){this.$PagesMessagingInboxOverviewMessageProcessor5(i.MARK_READ);this.$PagesMessagingInboxOverviewMessageProcessor6(this.$PagesMessagingInboxOverviewMessageProcessor3.batchMarkRead);};o.prototype.markAsArchive=function(){this.$PagesMessagingInboxOverviewMessageProcessor5(i.MARK_ARCHIVE);this.$PagesMessagingInboxOverviewMessageProcessor6(this.$PagesMessagingInboxOverviewMessageProcessor3.batchArchive);};f.exports=o;},null);
__d('PagesMessagingMessageSnippet.react',['Image.react','Layout.react','PagesMessagingLoadingRow.react','React','cx','fbt','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o,p,q=i.Column,r=i.FillColumn;o=babelHelpers.inherits(s,k.Component);p=o&&o.prototype;function s(t,u){'use strict';p.constructor.call(this,t,u);}s.prototype.render=function(){'use strict';var t=n("_3sfn"+(!this.props.shouldShowFullView&&this.props.message?' '+"_3x9o":'')+(!this.props.shouldShowFullView?' '+"_3x9p":''),this.props.className),u=this.$PagesMessagingMessageSnippet1();if(this.props.shouldShowFullView)return (k.createElement('div',{className:t},u));return (k.createElement('div',{'aria-label':m._("Click to read and act on the full message."),'data-hover':'tooltip',className:t,onClick:this.props.onBodyClicked},u));};s.prototype.$PagesMessagingMessageSnippet1=function(){'use strict';return (k.createElement(i,null,k.createElement(q,null,this.$PagesMessagingMessageSnippet2()),k.createElement(r,null,this.$PagesMessagingMessageSnippet3())));};s.prototype.$PagesMessagingMessageSnippet2=function(){'use strict';if(!this.props.message)return (k.createElement(j,{className:"_3sfo"}));return (k.createElement(h,{className:"_3sfo",src:this.props.message?this.props.message.senderImageSrc:''}));};s.prototype.$PagesMessagingMessageSnippet3=function(){'use strict';var t=this.props.message;if(!t)return (k.createElement('div',{className:"_3sfp"},k.createElement(j,{className:"_3sfq"}),k.createElement(j,{className:"_3sfr"})));return (k.createElement('div',{className:"_3sfp"},k.createElement('div',{className:"_3sfs _3sg9"},t.senderName),k.createElement('div',{className:"_3sga"+(!this.props.shouldShowFullView?' '+"_3sg9":'')},t.content)));};f.exports=s;},null);
__d('PagesMessagingInboxOverview.react',['AbstractTextInput.react','Layout.react','LeftRight.react','PagesMessageSnippetFetcher','PagesMessagingHomePageletAction','PagesMessagingHomePageletLogger','PagesMessagingInboxOverviewActionMenu.react','PagesMessagingInboxOverviewMessageProcessor','PagesMessagingMessageSnippet.react','PagesMessagingRelativeTimestamp.react','PagesMessengerActions','React','cx','invariant','fbt','emptyFunction'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){if(c.__markCompiled)c.__markCompiled();var x,y;'use strict';var z=i.Column,aa=i.FillColumn;x=babelHelpers.inherits(ba,s.Component);y=x&&x.prototype;function ba(ca,da){y.constructor.call(this,ca,da);this.$PagesMessagingInboxOverview1=this.$PagesMessagingInboxOverview2(ca.pageInfo);this.$PagesMessagingInboxOverview3=new m(this.props.isEmbedded);this.$PagesMessagingInboxOverview4=(function(ea){this.setState({replyMessage:ea.target.value});}).bind(this);this.$PagesMessagingInboxOverview5=this.$PagesMessagingInboxOverview6.bind(this);this.$PagesMessagingInboxOverview7=this.$PagesMessagingInboxOverview7.bind(this);this.$PagesMessagingInboxOverview8=(function(){this.setState({shouldShowFullView:true},(function(){this.refs.input.focusInput();}).bind(this));this.$PagesMessagingInboxOverview3.logEventWithUserMessage(l.CLICK_MESSAGE,this.state.lastUnreadMessage?this.state.lastUnreadMessage.content:'');}).bind(this);this.state={lastUnreadMessage:null,replyMessage:'',noMoreMessage:false,shouldShowFullView:false};}ba.prototype.componentDidMount=function(){this.$PagesMessagingInboxOverview1.fetch();};ba.prototype.componentWillUnmount=function(){this.$PagesMessagingInboxOverview1.cleanup();};ba.prototype.componentWillReceiveProps=function(ca){if(ca.pageInfo!==this.props.pageInfo){this.setState({lastUnreadMessage:null});this.$PagesMessagingInboxOverview1=this.$PagesMessagingInboxOverview2(ca.pageInfo);this.$PagesMessagingInboxOverview1.fetch();}};ba.prototype.render=function(){if(this.state.noMoreMessage&&this.props.shouldHideIfNoMoreMessage)return null;var ca=null;if(this.state.noMoreMessage){ca=this.$PagesMessagingInboxOverview9();}else{var da=this.state.lastUnreadMessage;if(da){ca=this.$PagesMessagingInboxOverview10(da);}else ca=this.$PagesMessagingInboxOverview11();}return (s.createElement('div',{className:this.props.className},ca));};ba.prototype.$PagesMessagingInboxOverview12=function(){!(this.$PagesMessagingInboxOverview13&&this.state.lastUnreadMessage&&this.$PagesMessagingInboxOverview13.getTargetThreadID()===this.state.lastUnreadMessage.threadID)?u(0):undefined;};ba.prototype.$PagesMessagingInboxOverview2=function(ca){return new k(ca.id.toString(),(function(da){return this.$PagesMessagingInboxOverview14(da);}).bind(this),(function(){return this.$PagesMessagingInboxOverview15();}).bind(this));};ba.prototype.$PagesMessagingInboxOverview14=function(ca){this.setState({lastUnreadMessage:ca,noMoreMessage:false},(function(){this.$PagesMessagingInboxOverview13=new o(this.props.pageInfo.creatorInfo,this.props.pageInfo.id,this.props.isEmbedded,ca);}).bind(this));};ba.prototype.$PagesMessagingInboxOverview15=function(){this.setState({noMoreMessage:true});};ba.prototype.$PagesMessagingInboxOverview6=function(ca){if(ca.key==='Enter'&&this.state.replyMessage.length>0){this.$PagesMessagingInboxOverview12();this.$PagesMessagingInboxOverview13.sendMessage(this.state.replyMessage);this.setState({replyMessage:''});}};ba.prototype.$PagesMessagingInboxOverview7=function(ca){this.$PagesMessagingInboxOverview12();switch(ca){case r.MARK_AS_READ:this.$PagesMessagingInboxOverview13.markAsRead();break;case r.MARK_AS_SPAM:this.$PagesMessagingInboxOverview13.markAsSpam();break;case r.ARCHIVE:this.$PagesMessagingInboxOverview13.markAsArchive();break;case r.GO_TO_INBOX:this.$PagesMessagingInboxOverview3.logEvent(l.GO_TO_INBOX);break;}};ba.prototype.$PagesMessagingInboxOverview9=function(){return (s.createElement('div',{className:"_4c40"},v._("No more unread message")));};ba.prototype.$PagesMessagingInboxOverview11=function(){return (s.createElement(p,{className:"_3-8y _2iza _12f2",href:'#',message:this.state.lastUnreadMessage,onBodyClicked:w,shouldShowFullView:false}));};ba.prototype.$PagesMessagingInboxOverview16=function(ca){return k.getSpecificThreadInboxURI(this.props.pageInfo.uriToken,ca.threadID);};ba.prototype.$PagesMessagingInboxOverview10=function(ca){return (s.createElement('div',{className:"_3-8y"},s.createElement(j,null,s.createElement('div',{className:"_2iz9"},v._("Latest Unread Message")),s.createElement(q,{className:"_2iz6",utcTimestamp:ca.timestamp,shouldShorternTime:false})),s.createElement(p,{className:"_2iza",href:this.$PagesMessagingInboxOverview16(ca),message:ca,onBodyClicked:this.$PagesMessagingInboxOverview8,shouldShowFullView:this.state.shouldShowFullView}),this.$PagesMessagingInboxOverview17(ca)));};ba.prototype.$PagesMessagingInboxOverview17=function(ca){var da=this.state.lastUnreadMessage;if(!da||!this.state.shouldShowFullView)return null;var ea=v._("Reply to {sender short name} here...",[v.param('sender short name',da.senderShortName)]);return (s.createElement('div',{className:"_12f1 _3x9o"},s.createElement(i,null,s.createElement(aa,{className:"_2pii"},s.createElement(h,{placeholder:ea,value:this.state.replyMessage,onChange:this.$PagesMessagingInboxOverview4,onKeyDown:this.$PagesMessagingInboxOverview5,ref:'input'})),s.createElement(z,null,s.createElement(n,{className:"_12f0",message:ca,onActionTaken:this.$PagesMessagingInboxOverview7,inboxUri:this.$PagesMessagingInboxOverview16(ca)})))));};f.exports=ba;},null);